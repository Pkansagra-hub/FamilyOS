---
config:
  flowchart:
    htmlLabels: f     TO_PRODUCTION_DEPLOYMENT["â†’ TO Production Systems / Runtime<br/>â€¢ Memory-powered Family AI deployment<br/>ğŸ§  Cross-device Memory sync â€¢ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family Memory coordination"]:::infrastructure_coreTO_MEMORY_BACKBONE["â†’ TO Memory Backbone (D1)<br/>ğŸ§  Infrastructure support FOR Memory operations<br/>â€¢ Consolidated memories â€¢ ğŸ” Knowledge graphs â€¢ ğŸ“Š Performance insights"]:::brainROM_COGNITIVE_CORE["â† FROM Cognitive Core (D2)<br/>ğŸ§  Cognitive processes requiring infrastructure<br/>â€¢ Working memory consolidation â€¢ ğŸ§  Attention state persistence"]:::brainlse
    curve: linear
  theme: neo
  layout: elk
  look: neo
---

flowchart TB

%% ====== CORE CLASS STYLES (match Diagram 1) ======
classDef plane fill:#eef7ff,stroke:#2a6ebb,stroke-width:1px,rx:8,ry:8
classDef mid fill:#f8fff0,stroke:#6b8e23,stroke-width:1px,rx:8,ry:8
classDef gate fill:#fff7e6,stroke:#d48806,stroke-width:1px,rx:8,ry:8
classDef bus fill:#f0f0f0,stroke:#666,stroke-width:2px,rx:8,ry:8
classDef storage fill:#f3f8ff,stroke:#1f4aa1,stroke-width:1px,rx:8,ry:8
classDef brain fill:#fffdf0,stroke:#b38b00,stroke-width:1px,rx:10,ry:10
classDef fast stroke:#00897b,stroke-width:2px
classDef smart stroke:#d46b08,stroke-width:2px,stroke-dasharray:4 3
classDef card fill:#fff,stroke:#999,stroke-width:1px,rx:8,ry:8

%% Category tints (kept)
classDef infrastructure_core fill:#fff9c4,stroke:#faad14,stroke-width:2px,rx:10,ry:10
classDef consolidation fill:#f6ffed,stroke:#52c41a,stroke-width:2px,rx:8,ry:8
classDef prospective_memory fill:#e6f7ff,stroke:#1890ff,stroke-width:2px,rx:8,ry:8
classDef knowledge_graph fill:#f9f0ff,stroke:#722ed1,stroke-width:2px,rx:8,ry:8
classDef security_safety fill:#fff1f0,stroke:#ff4d4f,stroke-width:2px,rx:8,ry:8
classDef observability fill:#fff7e6,stroke:#d48806,stroke-width:2px,rx:8,ry:8
classDef sync_edge fill:#f0f5ff,stroke:#2f54eb,stroke-width:2px,rx:8,ry:8

%% ====== FAMILY INFRASTRUCTURE LEGEND ======
subgraph FAMILY_LEGEND["ğŸ¨ Family Infrastructure Diagram Guide"]
  L1["Unified classes/colors as Diagram 1"]:::card
  L2["family.infra.* & family.privacy.* topics carry cognitive_trace_id"]:::card
  L3["ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family-aware hand-offs: P03/P05/P07/P08/P10/P11â€“P15/P16/P17â€“P20"]:::card
  L4["ğŸ“± Cross-device receipts/outbox/WAL/offsets/DLQ coordination"]:::card
  L5["ğŸ’° Subscription enforcement at infrastructure level"]:::card
  L6["ğŸš¨ Family emergency protocols and failsafes"]:::card
end

%% ====== MEMORY BACKBONE INFRASTRUCTURE CONNECTIONS ======
subgraph MEMORY_BACKBONE_INFRASTRUCTURE_CONNECTIONS["ğŸ§  Memory Backbone Infrastructure Connections"]
  FROM_MEMORY_BACKBONE["â† FROM Memory Backbone (D1)<br/>ğŸ§  Memory operations requiring infrastructure support<br/>ğŸ“Š Memory metrics & traces â€¢ ğŸ” Memory security policies"]:::brain
  FROM_COGNITIVE_CORE["â† FROM Cognitive Core (D2)<br/>ğŸ§  Cognitive processes requiring infrastructure<br/>ï¿½ Working memory consolidation â€¢ ğŸ§  Attention state persistence"]:::brain
  FROM_INTELLIGENCE_SYSTEMS["â† FROM Intelligence Systems (D3)<br/>ğŸ§  Intelligence insights requiring storage<br/>ğŸ“ˆ Learning traces â€¢ ğŸ¤ Social analytics â€¢ ğŸ§  Decision records"]:::brain
  TO_MEMORY_BACKBONE["â†’ TO Memory Backbone (D1)<br/>ğŸ§  Infrastructure support FOR Memory operations<br/>ï¿½ Consolidated memories â€¢ ğŸ” Knowledge graphs â€¢ ğŸ“Š Performance insights"]:::brain
  TO_PRODUCTION_DEPLOYMENT["â†’ TO Production Systems / Runtime<br/>ï¿½ Memory-powered Family AI deployment<br/>ğŸ§  Cross-device Memory sync â€¢ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family Memory coordination"]:::infrastructure_core
end
class MEMORY_BACKBONE_INFRASTRUCTURE_CONNECTIONS card

%% ====== PIPELINE & SSE ANCHORS ======
subgraph PIPELINE_ANCHORS["ğŸ”— Pipeline & SSE Anchors"]
  TO_P03["â†’ P03 Consolidation/Forgetting"]:::bus
  TO_P05["â†’ P05 Prospective/Triggers"]:::bus
  TO_P07["â†’ P07 Sync/CRDT"]:::bus
  TO_P08["â†’ P08 Embedding Lifecycle"]:::bus
  TO_P10["â†’ P10 PII/Minimization"]:::bus
  TO_P11["â†’ P11 DSAR/GDPR"]:::bus
  TO_P12["â†’ P12 Device/E2EE"]:::bus
  TO_P13["â†’ P13 Index Rebuild"]:::bus
  TO_P14["â†’ P14 Near-Duplicate/Canon"]:::bus
  TO_P15["â†’ P15 Rollups/Summaries"]:::bus
  TO_P16["â†’ P16 Feature Flags/A-B"]:::bus
  TO_P17["â†’ P17 QoS/Cost Governance"]:::bus
  TO_P18["â†’ P18 Safety/Abuse"]:::bus
  TO_P19["â†’ P19 Personalization/Reco"]:::bus
  TO_P20["â†’ P20 Procedures/Habits"]:::bus
  TO_SSE_INFRA["â†’ SSE ACL: infra.* & privacy.* (sanitized)"]:::plane
end
class PIPELINE_ANCHORS card

%% ====== BUS BRIDGE & INTERNALS ======
subgraph BUS_BRIDGE["ğŸ“¡ Events Bus & Internals (cognitive_trace_id)"]
  EVT_BUS_ANCHOR["events.bus"]:::bus
  EVT_SCHEMA_VALID["events/validation.py (schema)"]:::gate
  EVT_PERSIST["events/persistence.py (WAL/offsets)"]:::mid
  EVT_DISPATCH["events/dispatcher.py"]:::mid
  EVT_SUBS["events/subscription.py"]:::mid
  EVT_MW["events/middleware.py"]:::mid
  OUTBOX_DRAINER["events/outbox_drainer.py"]:::bus
  DLQ_REPLAYER["events/dlq_replayer.py"]:::bus

  %% Topics
  INFRA_TOPICS["infra.*"]:::bus
  PRIVACY_TOPICS["privacy.*"]:::bus
  INFRA_CONS_T["infra.consolidation.*"]:::bus
  INFRA_KG_T["infra.kg.*"]:::bus
  INFRA_PROS_T["infra.prospective.*"]:::bus
  INFRA_SYNC_T["infra.sync.*"]:::bus
  INFRA_SEC_T["infra.security.*"]:::bus
  INFRA_OBS_T["infra.observability.*"]:::bus
  INFRA_ML_T["infra.ml.*"]:::bus

  %% Helpers referenced in flows
  EV_SEMANTIC_FILTERS["events.semantic_filters"]:::bus
  EV_CAUSAL_INDEXING["events.causal_indexing"]:::bus
  EV_PATTERN_STORAGE["events.pattern_storage"]:::bus
end
class BUS_BRIDGE card

%% ====== STORAGE PRIMITIVES & DURABILITY ======
subgraph STORAGE_PRIMITIVES["ğŸ’¾ Core Storage & Durability"]
  ST_EPISODIC["ğŸ“˜ st_episodic"]:::storage
  ST_SEMANTIC["ğŸ“™ st_semantic"]:::storage
  ST_VECTOR["ğŸ§­ st_vector"]:::storage
  ST_FTS["ğŸ” st_fts"]:::storage
  ST_BLOB["ğŸ—‚ï¸ st_blob"]:::storage
  ST_KG_STORE["ğŸ•¸ï¸ st_kg"]:::storage
  ST_RECEIPTS["ğŸ§¾ st_receipts"]:::storage
  ST_OUTBOX["ğŸ“® st_outbox"]:::storage
  ST_WAL["ğŸ“œ st_wal"]:::storage
  ST_OFFSETS["ğŸ§­ st_offsets"]:::storage
  ST_DLQ["ğŸ§° st_dlq"]:::storage
  ST_SNAPSHOTS["ğŸ“¸ st_snapshots"]:::storage
  ST_PII_MAP["ğŸ—ºï¸ st_pii_map"]:::storage
  ST_REDACTION_LOG["ğŸ“ st_redaction_log"]:::storage
  ST_REGS["ğŸ“š st_regs (registries)"]:::storage
  ST_ML_ART["ğŸ§ª st_ml_artifacts"]:::storage
end
class STORAGE_PRIMITIVES card

%% ====== REGISTRIES ======
subgraph REGISTRIES["ğŸ“‡ Registries"]
  REG_TOOLS["registry/tools"]:::mid
  REG_PROMPTS["registry/prompts"]:::mid
  REG_AGENTS["registry/agents"]:::mid
end
class REGISTRIES card

%% ====== MEMORY BACKBONE CONSOLIDATION & REPLAY ======
subgraph MEMORY_BACKBONE_CONSOLIDATION["ğŸŒ™ Memory Backbone Consolidation & Replay"]
  direction TB
  subgraph MEMORY_SLEEP_COORDINATION["ğŸ§  Memory-Driven Sleep Coordination"]
    SLEEP_SCHEDULER["â° Memory Sleep Scheduler<br/>ğŸ§  MEMORY BACKBONE SLEEP COORDINATION:<br/>â€¢ Memory-driven consolidation scheduling<br/>â€¢ Memory load-based sleep triggers<br/>â€¢ Memory optimization timing<br/>â¡ï¸ SERVES: Memory Backbone consolidation timing"]:::consolidation
    SLEEP_STATE_MACHINE["ğŸ”„ Memory Sleep State Machine<br/>ğŸ§  Memory consolidation state management<br/>â¡ï¸ SERVES: Memory Backbone sleep cycles"]:::consolidation
    SLEEP_TRIGGER["ğŸ¯ Memory Sleep Triggers<br/>ğŸ§  Memory-based consolidation initiation<br/>â¡ï¸ SERVES: Memory Backbone optimization triggers"]:::consolidation
  end

  subgraph MEMORY_CONSOLIDATION_PROCESSES["ğŸ§  Memory Backbone Consolidation Processes"]
    CONS_HIPPOCAMPAL["ğŸ§  Memory Hippocampal Replay<br/>ğŸ§  MEMORY BACKBONE HIPPOCAMPAL REPLAY:<br/>â€¢ Memory pattern replay FOR Memory strengthening<br/>â€¢ Memory sequence consolidation<br/>â€¢ Memory importance weighting<br/>â¡ï¸ SERVES: Memory Backbone strengthening"]:::consolidation
    CONS_NEOCORTICAL["ğŸ—‚ï¸ Memory Neocortical Integration<br/>ğŸ§  Memory integration INTO long-term knowledge<br/>â¡ï¸ SERVES: Memory Backbone knowledge integration"]:::consolidation
    CONS_SYNAPTIC["âš¡ Memory Synaptic Homeostasis<br/>ğŸ§  Memory connection optimization<br/>â¡ï¸ SERVES: Memory Backbone connection health"]:::consolidation
  end

  subgraph MEMORY_CONSOLIDATION_TYPES["ğŸ§  Memory Backbone Consolidation Types"]
    CONS_EPISODIC["ğŸ“… Memory Episodic Consolidation<br/>ğŸ§  Episode consolidation FOR Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone episodes"]:::consolidation
    CONS_SEMANTIC["ğŸ“š Memory Semantic Consolidation<br/>ğŸ§  Knowledge consolidation INTO Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone knowledge"]:::consolidation
    CONS_PROCEDURAL["âš™ï¸ Memory Procedural Consolidation<br/>ğŸ§  Skill consolidation THROUGH Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone skills"]:::consolidation
    CONS_EMOTIONAL["ğŸ’— Memory Emotional Consolidation<br/>ğŸ§  Emotional memory strengthening IN Memory Backbone<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family emotional memories<br/>â¡ï¸ SERVES: Memory Backbone emotional intelligence"]:::consolidation
  end

  subgraph MEMORY_LEGACY_CONSOLIDATION["âš™ï¸ Memory-Enhanced Legacy Consolidation"]
    LEG_COMPACTOR["ğŸ“¦ Memory Consolidation Compactor<br/>ğŸ§  Memory-driven compaction FOR Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone optimization"]:::consolidation
    LEG_ROLLUPS["ğŸ“Š Memory Consolidation Rollups<br/>ğŸ§  Memory summary generation FOR Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone summaries"]:::consolidation
    LEG_REPLAY["ğŸ”„ Memory Consolidation Replay<br/>ğŸ§  Memory replay coordination FOR Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone replay"]:::consolidation
  end
end
class MEMORY_BACKBONE_CONSOLIDATION card

%% ====== KNOWLEDGE GRAPH ======
subgraph KNOWLEDGE_GRAPH["ğŸ•¸ï¸ Temporal Knowledge Graph & Reasoning"]
  KG_TEMPORAL_ENGINE["ğŸ”„ Temporal Reasoning Engine"]:::knowledge_graph
  KG_VERSION_CONTROL["ğŸ—ƒï¸ Knowledge Versioning"]:::knowledge_graph
  KG_CAUSAL_GRAPH["ğŸ”— Causal Graph"]:::knowledge_graph
  KG_CONCEPT_EVOLUTION["ğŸŒ± Concept Evolution"]:::knowledge_graph
  KG_RELATION_DISCOVERY["ğŸ” Relation Discovery"]:::knowledge_graph
  KG_INCONSISTENCY_RESOLUTION["âš–ï¸ Inconsistency Resolution"]:::knowledge_graph
  KG_SENSORY_GROUNDING["ğŸ‘ï¸ Sensory Grounding"]:::knowledge_graph
  KG_LINGUISTIC_MAPPING["ğŸ—£ï¸ Linguistic Mapping"]:::knowledge_graph
  KG_PROCEDURAL_LINKING["âš™ï¸ Procedural Linking"]:::knowledge_graph
  LEG_KG_TEMPORAL["â° kg/temporal.py"]:::knowledge_graph
  LEG_KG_JOBS["ğŸ”„ consolidation/kg_jobs.py"]:::knowledge_graph
end
class KNOWLEDGE_GRAPH card

%% ====== PROSPECTIVE MEMORY ======
subgraph PROSPECTIVE_MEMORY["ğŸ”® Prospective Memory State Machine"]
  PROS_INTENTION_FORMATION["ğŸ’­ Intention Formation"]:::prospective_memory
  PROS_CUE_MONITORING["ğŸ‘ï¸ Cue Monitoring"]:::prospective_memory
  PROS_RETRIEVAL_ENGINE["ğŸ” Retrieval Engine"]:::prospective_memory
  PROS_EXECUTION_CONTROL["âš¡ Execution Control"]:::prospective_memory
  PROS_TIME_BASED["â° Time-Based"]:::prospective_memory
  PROS_EVENT_BASED["ğŸ¯ Event-Based"]:::prospective_memory
  PROS_ACTIVITY_BASED["ğŸƒ Activity-Based"]:::prospective_memory
  PROS_PRIORITY_MANAGER["ğŸ“Š Priority Manager"]:::prospective_memory
  PROS_INTERFERENCE_CONTROL["ğŸ›¡ï¸ Interference Control"]:::prospective_memory
  PROS_FORGETTING_PREVENTION["ğŸ”’ Forgetting Prevention"]:::prospective_memory
  LEG_PROS_ENGINE["ğŸ”„ prospective/engine.py"]:::prospective_memory
  LEG_PROS_SCHEDULER["ğŸ“… prospective/scheduler.py"]:::prospective_memory
  LEG_PROS_STATE_MACHINE["ğŸ›ï¸ prospective/state_machine.py"]:::prospective_memory
end
class PROSPECTIVE_MEMORY card

%% ====== EDGE & SYNC ======
subgraph EDGE_SYNC["ğŸŒ Edge Computing & P2P Sync"]
  SYNC_COGNITIVE_ROUTER["ğŸ¯ Cognitive Sync Router"]:::sync_edge
  SYNC_CONFLICT_RESOLUTION["âš–ï¸ Conflict Resolution"]:::sync_edge
  SYNC_ADAPTIVE_STRATEGY["ğŸ”„ Adaptive Strategy"]:::sync_edge
  EDGE_COGNITIVE_CACHE["ğŸ’¾ Cognitive Cache"]:::sync_edge
  EDGE_FEDERATED_LEARNING["ğŸ¤ Federated Learning"]:::sync_edge
  EDGE_OFFLINE_INTELLIGENCE["ğŸ“± Offline Intelligence"]:::sync_edge
  LEG_SYNC_MANAGER["ğŸ”„ sync/sync_manager.py"]:::sync_edge
  LEG_REPLICATOR["ğŸ“‹ sync/replicator.py"]:::sync_edge
  LEG_CRDT["ğŸŒ¿ sync/crdt.py"]:::sync_edge
end
class EDGE_SYNC card

%% ====== ML & ADAPTATION ======
subgraph ML_ADAPTATION["ğŸ¤– Machine Learning & Adaptation"]
  ML_CONTINUAL_LEARNING["ğŸ”„ Continual Learning"]:::sync_edge
  ML_META_LEARNING["ğŸ­ Meta-Learning"]:::sync_edge
  ML_SELF_SUPERVISED["ğŸ” Self-Supervised"]:::sync_edge
  ML_USER_MODELING["ğŸ‘¤ User Modeling"]:::sync_edge
  ML_CONTEXTUAL_ADAPTATION["ğŸ¯ Contextual Adaptation"]:::sync_edge
  ML_FEEDBACK_LEARNING["ğŸ“Š Feedback Learning"]:::sync_edge
  LEG_ML_RUNNER["ğŸƒ ml_capsule/runs/runner.py"]:::sync_edge
  LEG_STRESS_HARNESS["ğŸ§ª ml_capsule/stress/harness.py"]:::sync_edge
  LEG_MODEL_REGISTRY["ğŸ“š ml_capsule/models/registry.py"]:::sync_edge
end
class ML_ADAPTATION card

%% ====== SECURITY & SAFETY ======
subgraph SECURITY_SAFETY["ğŸ›¡ï¸ Security & Safety"]
  SEC_THREAT_DETECTION["ğŸš¨ Threat Detection"]:::security_safety
  SEC_ADAPTIVE_DEFENSE["ğŸ›¡ï¸ Adaptive Defense"]:::security_safety
  SEC_ZERO_TRUST["ğŸ¯ Zero Trust"]:::security_safety
  MLS_CLASSIFICATION["ğŸ“‹ Classification"]:::security_safety
  MLS_ENFORCEMENT["âš¡ Enforcement"]:::security_safety
  MLS_BAND_CONTROL["ğŸ¨ Band Control"]:::security_safety
  E2EE_KEY_MANAGEMENT["ğŸ”‘ Key Management"]:::security_safety
  E2EE_MLS_GROUPS["ğŸ‘¥ MLS Groups"]:::security_safety
  E2EE_SELECTIVE_SHARING["ğŸ¯ Selective Sharing"]:::security_safety
  HSM_SERVICE["ğŸ§° HSM/TEE Attestation"]:::security_safety
  RATCHET_SVC["ğŸ” Ratchet Service"]:::security_safety
  LEG_KEY_MANAGER["ğŸ”‘ security/key_manager.py"]:::security_safety
  LEG_ENCRYPTOR["ğŸ”’ security/encryptor.py"]:::security_safety
  LEG_MLS_GROUP["ğŸ‘¥ security/mls_group.py"]:::security_safety
end
class SECURITY_SAFETY card

%% ====== POLICY, P10 & GOVERNANCE ======
subgraph POLICY_GOVERNANCE["âš–ï¸ Policy, PII Minimization & Governance"]
  POL_RULES_ENGINE["ğŸ“‹ Policy Rules Engine"]:::security_safety
  POL_COMPLIANCE_TRACKER["ğŸ§¾ Compliance Tracking"]:::security_safety
  POL_DECISION_CACHE["ğŸ—„ï¸ Policy Decision Cache"]:::security_safety
  POL_DYNAMIC_CONSENT["âœ… Dynamic Consent"]:::security_safety
  POL_PRIVACY_BUDGET["ğŸ“Š Privacy Budget"]:::security_safety
  POL_DATA_MINIMIZATION["ğŸ¯ Data Minimization"]:::security_safety

  %% P10 concrete
  PII_MINIMIZER["ğŸ” pii_minimizer_service (P10)"]:::gate
  PII_SCHEMA_REG["pii_schema_registry"]:::gate
  REDACTION_COORD["redaction_coordinator"]:::smart
end
class POLICY_GOVERNANCE card

%% ====== MEMORY BACKBONE OBSERVABILITY & MONITORING ======
subgraph MEMORY_BACKBONE_OBSERVABILITY["ğŸ”­ Memory Backbone Observability & Intelligence Monitoring"]
  subgraph MEMORY_COGNITIVE_METRICS["ğŸ“ˆ Memory Backbone Cognitive Metrics"]
    OBS_COGNITIVE_METRICS["ğŸ“ˆ Memory Cognitive Metrics<br/>ğŸ§  MEMORY BACKBONE COGNITIVE MONITORING:<br/>â€¢ Memory operation performance tracking<br/>â€¢ Memory formation & retrieval metrics<br/>â€¢ Memory quality & accuracy measurements<br/>â¡ï¸ MONITORS: Memory Backbone cognitive health"]:::observability
    OBS_MEMORY_ANALYTICS["ğŸ’¾ Memory Backbone Analytics<br/>ğŸ§  Memory analytics FOR Memory optimization<br/>â¡ï¸ MONITORS: Memory Backbone performance"]:::observability
    OBS_INTELLIGENCE_DASHBOARD["ğŸ“Š Memory Intelligence Dashboard<br/>ğŸ§  Intelligence metrics FROM Memory operations<br/>â¡ï¸ MONITORS: Memory Backbone intelligence"]:::observability
  end

  subgraph MEMORY_DISTRIBUTED_MONITORING["ğŸ” Memory Backbone Distributed Monitoring"]
    OBS_DISTRIBUTED_TRACING["ğŸ” Memory Distributed Tracing<br/>ğŸ§  Memory operation tracing ACROSS Memory Backbone<br/>ğŸ“± Cross-device Memory coordination tracking<br/>â¡ï¸ MONITORS: Memory Backbone distribution"]:::observability
    OBS_ADAPTIVE_SAMPLING["ğŸ¯ Memory Adaptive Sampling<br/>ğŸ§  Memory-aware sampling FOR Memory insights<br/>â¡ï¸ MONITORS: Memory Backbone sampling"]:::observability
    OBS_ANOMALY_DETECTION["ğŸš¨ Memory Anomaly Detection<br/>ğŸ§  Memory operation anomaly detection<br/>â¡ï¸ MONITORS: Memory Backbone health"]:::observability
  end

  subgraph MEMORY_BEHAVIORAL_ANALYTICS["ğŸ­ Memory Backbone Behavioral Analytics"]
    OBS_BEHAVIORAL_ANALYTICS["ğŸ­ Memory Behavioral Analytics<br/>ğŸ§  Memory usage pattern analysis<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family Memory behavior insights<br/>â¡ï¸ MONITORS: Memory Backbone usage patterns"]:::observability
    OBS_CAUSAL_ANALYSIS["ğŸ”— Memory Causal Analysis<br/>ğŸ§  Memory relationship causality analysis<br/>â¡ï¸ MONITORS: Memory Backbone relationships"]:::observability
    OBS_PREDICTIVE_INSIGHTS["ğŸ”® Memory Predictive Insights<br/>ğŸ§  Memory-driven predictive analytics<br/>â¡ï¸ MONITORS: Memory Backbone predictions"]:::observability
  end

  subgraph MEMORY_OBSERVABILITY_INFRASTRUCTURE["ğŸ”§ Memory Observability Infrastructure"]
    OBS_METRIC_SINK["ğŸ§  Memory Metric Sink<br/>ğŸ§  Memory metrics aggregation FOR Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone metrics"]:::observability
  end
end
class MEMORY_BACKBONE_OBSERVABILITY card

%% ====== CONNECTOR INFRA (P09) ======
subgraph CONNECTORS_INFRA["ğŸ”Œ Connector Infrastructure (P09)"]
  CONNECTOR_REGISTRY["st_connectors"]:::storage
  OAUTH_VAULT["st_oauth_vault"]:::storage
  WEBHOOK_INGEST["webhook_ingest"]:::mid
  TOKEN_ROTATOR["token_rotator"]:::mid
end
class CONNECTORS_INFRA card

%% ====== EMBEDDING & INDEX LIFECYCLE (P08/P13) ======
subgraph EMBEDDING_LIFECYCLE["ğŸ§  Embeddings & Indexes (P08/P13)"]
  EMB_ORCH["embedding_orchestrator"]:::mid
  EMB_BUILDER["embedding_builder"]:::mid
  VEC_INDEX_BUILDER["vector_index_builder"]:::mid
  FTS_INDEXER_SVC["fts_indexer"]:::mid
  REINDEX_SCHED["reindex_scheduler"]:::mid
  REINDEX_WORKER["reindex_worker"]:::mid
end
class EMBEDDING_LIFECYCLE card

%% ====== WORKFLOWS & BACKUP/RESTORE ======
subgraph WORKFLOWS_BACKUP["ğŸ—“ï¸ Workflows & Backup/Restore"]
  WF_ENGINE["workflows/engine"]:::mid
  WF_SCHED["workflows/scheduler"]:::mid
  BACKUP_SCHED["backup/scheduler"]:::mid
  SNAPSHOT_MGR["backup/snapshot_manager"]:::mid
  RESTORE_MGR["backup/restore_manager"]:::mid
end
class WORKFLOWS_BACKUP card

%% ====== SAFETY PIPE (P18 complement) ======
subgraph SAFETY_PIPE["ğŸ§¯ Safety & Abuse Ops"]
  SAFETY_QUEUE["safety_queue"]:::bus
  SAFETY_WORKER["safety_worker"]:::mid
  FLAGGED_STORE["st_flagged_content"]:::storage
end
class SAFETY_PIPE card

%% ====== WIRING: External inputs ======
FROM_COGNITIVE_CORE-->SLEEP_SCHEDULER & KG_TEMPORAL_ENGINE & PROS_INTENTION_FORMATION
FROM_INTELLIGENCE_SYSTEMS-->ML_CONTINUAL_LEARNING & OBS_COGNITIVE_METRICS & POL_RULES_ENGINE
FROM_MEMORY_BACKBONE-->REG_TOOLS & REG_PROMPTS & REG_AGENTS

%% ====== WIRING: Bus internals ======
EVT_SCHEMA_VALID-->EVT_PERSIST
EVT_PERSIST<-->EVT_DISPATCH
EVT_DISPATCH<-->EVT_SUBS
EVT_MW<-->EVT_DISPATCH
OUTBOX_DRAINER-->EVT_BUS_ANCHOR
DLQ_REPLAYER-->EVT_BUS_ANCHOR

%% ====== WIRING: Consolidation ======
SLEEP_SCHEDULER-->SLEEP_STATE_MACHINE-->SLEEP_TRIGGER-->SLEEP_SCHEDULER
SLEEP_STATE_MACHINE-->CONS_HIPPOCAMPAL & CONS_NEOCORTICAL & CONS_SYNAPTIC
CONS_HIPPOCAMPAL-->CONS_EPISODIC & KG_TEMPORAL_ENGINE
CONS_NEOCORTICAL-->CONS_SEMANTIC & KG_CONCEPT_EVOLUTION
CONS_SYNAPTIC-->CONS_PROCEDURAL & CONS_EMOTIONAL
CONS_EPISODIC-->ST_EPISODIC & EV_CAUSAL_INDEXING
CONS_SEMANTIC-->ST_SEMANTIC & KG_RELATION_DISCOVERY
CONS_PROCEDURAL-->ST_SEMANTIC & ML_CONTINUAL_LEARNING
CONS_EMOTIONAL-->POL_DYNAMIC_CONSENT

%% ====== WIRING: Knowledge Graph ======
KG_TEMPORAL_ENGINE<-->KG_VERSION_CONTROL<-->KG_CAUSAL_GRAPH
KG_CONCEPT_EVOLUTION-->KG_RELATION_DISCOVERY-->KG_INCONSISTENCY_RESOLUTION
KG_SENSORY_GROUNDING<-->KG_LINGUISTIC_MAPPING<-->KG_PROCEDURAL_LINKING
KG_CAUSAL_GRAPH-->PROS_CUE_MONITORING & OBS_CAUSAL_ANALYSIS
LEG_KG_TEMPORAL<-->ST_KG_STORE

%% ====== WIRING: Prospective ======
PROS_INTENTION_FORMATION-->PROS_CUE_MONITORING-->PROS_RETRIEVAL_ENGINE-->PROS_EXECUTION_CONTROL
PROS_TIME_BASED & PROS_EVENT_BASED & PROS_ACTIVITY_BASED-->PROS_PRIORITY_MANAGER
PROS_PRIORITY_MANAGER-->PROS_INTERFERENCE_CONTROL-->PROS_FORGETTING_PREVENTION
PROS_EXECUTION_CONTROL-->EV_PATTERN_STORAGE & OBS_BEHAVIORAL_ANALYTICS

%% ====== WIRING: Edge/Sync ======
SYNC_COGNITIVE_ROUTER<-->SYNC_CONFLICT_RESOLUTION<-->SYNC_ADAPTIVE_STRATEGY
EDGE_COGNITIVE_CACHE-->EDGE_FEDERATED_LEARNING-->EDGE_OFFLINE_INTELLIGENCE

%% ====== WIRING: ML & Artifacts ======
EMB_BUILDER-->ST_VECTOR
FTS_INDEXER_SVC-->ST_FTS
REINDEX_WORKER-->ST_VECTOR & ST_FTS
LEG_MODEL_REGISTRY-->ST_ML_ART
ML_USER_MODELING-->ST_ML_ART

%% ====== WIRING: Policy, P10, Security ======
PII_MINIMIZER-->PII_SCHEMA_REG
PII_MINIMIZER-->ST_PII_MAP
REDACTION_COORD-->ST_REDACTION_LOG
SEC_ADAPTIVE_DEFENSE-->OBS_ANOMALY_DETECTION
MLS_BAND_CONTROL-->SYNC_CONFLICT_RESOLUTION
HSM_SERVICE-->E2EE_KEY_MANAGEMENT
RATCHET_SVC-->E2EE_KEY_MANAGEMENT

%% ====== WIRING: Registries ======
REG_TOOLS & REG_PROMPTS & REG_AGENTS-->ST_REGS

%% ====== WIRING: Workflows & Backup ======
WF_SCHED-->WF_ENGINE
BACKUP_SCHED-->SNAPSHOT_MGR-->ST_SNAPSHOTS
RESTORE_MGR-->ST_SNAPSHOTS

%% ====== WIRING: Durability path ======
ST_OUTBOX-->OUTBOX_DRAINER
EVT_PERSIST-->ST_WAL & ST_OFFSETS
EVT_BUS_ANCHOR-.nack/errors.->ST_DLQ
DLQ_REPLAYER-->ST_DLQ
ST_RECEIPTS-->OBS_INTELLIGENCE_DASHBOARD

%% ====== WIRING: Connector Infra ======
WEBHOOK_INGEST-->CONNECTOR_REGISTRY
TOKEN_ROTATOR-->OAUTH_VAULT

%% ====== BUS & SSE BRIDGING ======
CONS_HIPPOCAMPAL & CONS_NEOCORTICAL & CONS_SYNAPTIC-->INFRA_CONS_T
KG_TEMPORAL_ENGINE & KG_CAUSAL_GRAPH & KG_RELATION_DISCOVERY-->INFRA_KG_T
PROS_EXECUTION_CONTROL & PROS_PRIORITY_MANAGER-->INFRA_PROS_T
SYNC_COGNITIVE_ROUTER & SYNC_CONFLICT_RESOLUTION-->INFRA_SYNC_T
SEC_ADAPTIVE_DEFENSE & MLS_ENFORCEMENT-->INFRA_SEC_T
OBS_INTELLIGENCE_DASHBOARD & OBS_ANOMALY_DETECTION-->INFRA_OBS_T
EMB_ORCH & REINDEX_SCHED-->INFRA_ML_T
PII_MINIMIZER & REDACTION_COORD-->PRIVACY_TOPICS

INFRA_CONS_T & INFRA_KG_T & INFRA_PROS_T & INFRA_SYNC_T & INFRA_SEC_T & INFRA_OBS_T & INFRA_ML_T & PRIVACY_TOPICS-->EVT_BUS_ANCHOR
INFRA_CONS_T & INFRA_KG_T & INFRA_PROS_T & INFRA_SYNC_T & INFRA_SEC_T & INFRA_OBS_T & INFRA_ML_T & PRIVACY_TOPICS-->TO_SSE_INFRA

%% ====== MEMORY BACKBONE INFRASTRUCTURE WIRING ======

%% Memory Backbone core infrastructure inputs
FROM_MEMORY_BACKBONE-->SLEEP_SCHEDULER
FROM_MEMORY_BACKBONE-->CONS_HIPPOCAMPAL
FROM_MEMORY_BACKBONE-->CONS_SEMANTIC
FROM_MEMORY_BACKBONE-->OBS_MEMORY_ANALYTICS
FROM_MEMORY_BACKBONE-->OBS_COGNITIVE_METRICS
FROM_MEMORY_BACKBONE-->OBS_BEHAVIORAL_ANALYTICS
FROM_MEMORY_BACKBONE-->SYNC_COGNITIVE_ROUTER
FROM_MEMORY_BACKBONE-->ML_CONTINUAL_LEARNING
FROM_MEMORY_BACKBONE-->KG_TEMPORAL_ENGINE
FROM_MEMORY_BACKBONE-->PROS_INTENTION_FORMATION

%% Cognitive Core infrastructure coordination FOR Memory Backbone
FROM_COGNITIVE_CORE-->OBS_COGNITIVE_METRICS
FROM_COGNITIVE_CORE-->SYNC_COGNITIVE_ROUTER
FROM_COGNITIVE_CORE-->CONS_NEOCORTICAL
FROM_COGNITIVE_CORE-->KG_CONCEPT_EVOLUTION
FROM_COGNITIVE_CORE-->ML_META_LEARNING

%% Intelligence Systems infrastructure requirements FOR Memory Backbone
FROM_INTELLIGENCE_SYSTEMS-->OBS_INTELLIGENCE_DASHBOARD
FROM_INTELLIGENCE_SYSTEMS-->OBS_PREDICTIVE_INSIGHTS
FROM_INTELLIGENCE_SYSTEMS-->ML_CONTINUAL_LEARNING
FROM_INTELLIGENCE_SYSTEMS-->KG_RELATION_DISCOVERY
FROM_INTELLIGENCE_SYSTEMS-->PROS_CUE_MONITORING

%% Infrastructure consolidation outputs TO Memory Backbone
CONS_SEMANTIC-->TO_MEMORY_BACKBONE
CONS_EPISODIC-->TO_MEMORY_BACKBONE
CONS_PROCEDURAL-->TO_MEMORY_BACKBONE
CONS_EMOTIONAL-->TO_MEMORY_BACKBONE

%% Infrastructure observability outputs TO Memory Backbone
OBS_PREDICTIVE_INSIGHTS-->TO_MEMORY_BACKBONE
OBS_BEHAVIORAL_ANALYTICS-->TO_MEMORY_BACKBONE
OBS_DISTRIBUTED_TRACING-->TO_MEMORY_BACKBONE
OBS_METRIC_SINK-->TO_MEMORY_BACKBONE

%% Infrastructure intelligence outputs TO Memory Backbone
ML_USER_MODELING-->TO_MEMORY_BACKBONE
ML_CONTEXTUAL_ADAPTATION-->TO_MEMORY_BACKBONE
KG_CAUSAL_GRAPH-->TO_MEMORY_BACKBONE
PROS_EXECUTION_CONTROL-->TO_MEMORY_BACKBONE

%% Memory Backbone cross-infrastructure coordination
SLEEP_SCHEDULER-->CONS_HIPPOCAMPAL
SLEEP_SCHEDULER-->CONS_NEOCORTICAL
SLEEP_SCHEDULER-->CONS_SYNAPTIC
OBS_MEMORY_ANALYTICS-->ML_CONTINUAL_LEARNING
OBS_COGNITIVE_METRICS-->SYNC_ADAPTIVE_STRATEGY
SYNC_COGNITIVE_ROUTER-->EDGE_COGNITIVE_CACHE
ML_USER_MODELING-->POL_DYNAMIC_CONSENT
KG_TEMPORAL_ENGINE-->PROS_TIME_BASED

%% ====== PIPELINE HAND-OFFS ======
MEMORY_BACKBONE_CONSOLIDATION-->TO_P03 & TO_P15
PROSPECTIVE_MEMORY-->TO_P05
EDGE_SYNC & LEG_CRDT-->TO_P07
EMBEDDING_LIFECYCLE-->TO_P08 & TO_P13
POLICY_GOVERNANCE-->TO_P10 & TO_P11
SECURITY_SAFETY-->TO_P12 & TO_P18
REGISTRIES-->TO_P16
MEMORY_BACKBONE_OBSERVABILITY-->TO_P17
ML_ADAPTATION-->TO_P19
WORKFLOWS_BACKUP-->TO_P13
CONNECTORS_INFRA-->TO_P09
PROSPECTIVE_MEMORY-->TO_P20

%% ====== MEMORY BACKBONE CROSS-DIAGRAM OUTPUTS ======
SLEEP_STATE_MACHINE-->TO_PRODUCTION_DEPLOYMENT
OBS_INTELLIGENCE_DASHBOARD-->TO_PRODUCTION_DEPLOYMENT
CONS_HIPPOCAMPAL-->TO_MEMORY_BACKBONE
OBS_MEMORY_ANALYTICS-->TO_MEMORY_BACKBONE
