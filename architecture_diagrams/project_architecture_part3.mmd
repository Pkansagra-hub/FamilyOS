---
config:
  flowchart:
    htmlLabels: false
    curve: linear
  theme: neo
  layout: elk
  look: neo
---

flowchart TB

%% ====== CORE CLASS STYLES (match Diagram 1) ======
classDef plane fill:#eef7ff,stroke:#2a6ebb,stroke-width:1px,rx:8,ry:8
classDef mid fill:#f8fff0,stroke:#6b8e23,stroke-width:1px,rx:8,ry:8
classDef gate fill:#fff7e6,stroke:#d48806,stroke-width:1px,rx:8,ry:8
classDef bus fill:#f0f0f0,stroke:#666,stroke-width:2px,rx:8,ry:8
classDef storage fill:#f3f8ff,stroke:#1f4aa1,stroke-width:1px,rx:8,ry:8
classDef brain fill:#fffdf0,stroke:#b38b00,stroke-width:1px,rx:10,ry:10
classDef fast stroke:#00897b,stroke-width:2px
classDef smart stroke:#d46b08,stroke-width:2px,stroke-dasharray:4 3
classDef card fill:#fff,stroke:#999,stroke-width:1px,rx:8,ry:8

%% Category tints (kept, but aligned to style)
classDef intelligence_core fill:#fff9c4,stroke:#faad14,stroke-width:2px,rx:10,ry:10
classDef learning_loop fill:#f6ffed,stroke:#52c41a,stroke-width:2px,rx:8,ry:8
classDef social_cognition fill:#e6f7ff,stroke:#1890ff,stroke-width:2px,rx:8,ry:8
classDef metacognitive fill:#f9f0ff,stroke:#722ed1,stroke-width:2px,rx:8,ry:8
classDef procedural_memory fill:#fff1f0,stroke:#ff4d4f,stroke-width:2px,rx:8,ry:8
classDef reward_system fill:#fff7e6,stroke:#d48806,stroke-width:2px,rx:8,ry:8
classDef action_selection fill:#f0f5ff,stroke:#2f54eb,stroke-width:2px,rx:8,ry:8

%% ====== FAMILY INTELLIGENCE LEGEND & BOUNDARY ======
subgraph FAMILY_LEGEND["ğŸ¨ Family Intelligence Diagram Guide"]
  direction TB
  L1["ğŸ”µ/ğŸŸ¢/ğŸŸ¡/âš«/ğŸ”· = same classes as Diagram 1"]:::card
  L2["ğŸ§  = Family Cognitive/Intelligence modules (brain style)"]:::card
  L3["ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ = Family relationship-aware processing"]:::card
  L4["ğŸ“± = Cross-device intelligence coordination"]:::card
  L5["âš ï¸ Advisory-only: Family Intelligence emits signals â†’ P04; never executes actions"]:::card
end

subgraph FAMILY_ADVISORY_BOUNDARY["ğŸš§ Family Architectural Boundary"]
  B1["Family Intelligence Systems provide ADVISORY SIGNALS ONLY"]:::gate
  B2["P04 (Family Arbitration/Action) is the SOLE action executor"]:::gate
  B3["ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family relationship context respected in all decisions"]:::gate
end

%% ====== MEMORY BACKBONE EXTERNAL CONNECTIONS ======
subgraph MEMORY_BACKBONE_CONNECTIONS["ğŸ§  Memory Backbone Intelligence Connections"]
  FROM_MEMORY_BACKBONE["â† FROM Memory Backbone (D1)<br/>ğŸ§  Memory-driven intelligence â€¢ Family context â€¢ Emotional memories"]:::brain
  FROM_COGNITIVE_CORE["â† FROM Cognitive Core (D2)<br/>ğŸ§  Working memory â€¢ Global workspace â€¢ Attention state"]:::brain
  TO_MEMORY_BACKBONE["â†’ TO Memory Backbone (D1)<br/>ğŸ§  Intelligence insights â€¢ Learning updates â€¢ Social knowledge"]:::brain
  TO_P04_ACTIONS["â†’ TO Infrastructure P04 (D4)<br/>ï¿½ Advisory signals ONLY - no direct action"]:::plane
  TO_INFRASTRUCTURE["â†’ TO Infrastructure (D4)<br/>ğŸ“Š Intelligence metrics â€¢ Learning traces â€¢ Social analytics"]:::mid
end
class MEMORY_BACKBONE_CONNECTIONS card

%% ====== MEMORY-DRIVEN INTELLIGENCE INFRASTRUCTURE ======
subgraph MEMORY_INTELLIGENCE_INFRASTRUCTURE["ğŸ§  Memory-Driven Intelligence Infrastructure"]
  direction TB
  subgraph MEMORY_INTELLIGENCE_SERVICES["ğŸ§© Memory Backbone Intelligence Services"]
    INT_COORDINATOR["ğŸ­ Memory Intelligence Coordinator<br/>ğŸ§  MEMORY BACKBONE INTELLIGENCE ORCHESTRATION:<br/>â€¢ Memory-driven cross-system coordination<br/>â€¢ Memory resource management for intelligence<br/>â€¢ Memory-informed performance optimization<br/>â¡ï¸ SERVES: Memory Backbone intelligence operations"]:::intelligence_core
    INT_MEMORY_MANAGER["ğŸ’¾ Memory Backbone Intelligence Manager<br/>ğŸ§  MEMORY INTELLIGENCE COORDINATION:<br/>â€¢ Memory-aware working memory coordination<br/>â€¢ Memory consolidation handoff for intelligence<br/>â€¢ Memory-driven intelligence state management<br/>â¡ï¸ SERVES: Memory Backbone intelligence storage"]:::intelligence_core
    INT_EVENT_PROCESSOR["ğŸ“¡ Memory Intelligence Event Processor<br/>ğŸ§  MEMORY INTELLIGENCE EVENTS:<br/>â€¢ Memory-aware signal routing<br/>â€¢ Memory-driven state synchronization<br/>â€¢ Memory cognitive_trace_id correlation<br/>â¡ï¸ SERVES: Memory Backbone intelligence coordination"]:::intelligence_core
  end

  subgraph MEMORY_LEGACY_INTEGRATION["âš™ï¸ Memory-Enhanced Traditional Systems"]
    LEG_SOCIAL["ğŸ§‘â€ğŸ¤â€ğŸ§‘ Memory-Aware Social Cognition<br/>ğŸ§  Social intelligence FROM Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone social insights"]:::social_cognition
    LEG_METACOG["ğŸª Memory-Driven Metacognition<br/>ğŸ§  Self-reflection THROUGH Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone self-awareness"]:::metacognitive
    LEG_DRIVES["ğŸ”¥ Memory-Informed Drives<br/>ğŸ§  Motivation FROM Memory experiences<br/>â¡ï¸ SERVES: Memory Backbone motivation"]:::reward_system
    LEG_AFFECT["ğŸ’– Memory-Enhanced Affect<br/>ğŸ§  Emotions integrated WITH Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone emotional intelligence"]:::social_cognition
    LEG_ACTION["ğŸ¤– Memory-Guided Action<br/>ğŸ§  Actions informed BY Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone action intelligence"]:::action_selection
    LEG_LEARNING["ğŸ“Š Memory-Driven Learning<br/>ğŸ§  Learning coordinated THROUGH Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone adaptive intelligence"]:::learning_loop
    LEG_IMAGINATION["ğŸ§ª Memory-Powered Imagination<br/>ğŸ§  Creativity FROM Memory experiences<br/>â¡ï¸ SERVES: Memory Backbone creative intelligence"]:::brain
  end
end
class MEMORY_INTELLIGENCE_INFRASTRUCTURE card

%% ====== MEMORY-DRIVEN LEARNING LOOP & ADAPTIVE INTELLIGENCE ======
subgraph MEMORY_LEARNING_LOOP["ğŸ”„ Memory-Driven Learning Loop & Adaptive Intelligence"]
  direction TB
  subgraph MEMORY_LEARNING_CORE["ğŸ§  Memory Backbone Learning Core"]
    LEARN_COORDINATOR["ğŸ­ Memory Learning Coordinator<br/>ğŸ§  MEMORY BACKBONE LEARNING ORCHESTRATION:<br/>â€¢ Memory-driven learning coordination<br/>â€¢ Memory experience integration<br/>â€¢ Memory-informed adaptation strategies<br/>â¡ï¸ COORDINATES: Memory Backbone learning"]:::learning_loop
    LEARN_PREDICT["ğŸ”® Memory-Informed Predictive Learning<br/>ğŸ§  Predictions FROM Memory experiences<br/>â¡ï¸ SERVES: Memory Backbone predictions"]:::learning_loop
    LEARN_ADAPT["ğŸ”„ Memory-Driven Adaptive Controller<br/>ğŸ§  Adaptation THROUGH Memory insights<br/>â¡ï¸ SERVES: Memory Backbone adaptation"]:::learning_loop
    LEARN_FEEDBACK["ğŸ“Š Memory Learning Feedback Integration<br/>ğŸ§  Feedback integrated WITH Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone feedback loops"]:::learning_loop
  end
  subgraph MEMORY_LEARNING_SPECIALIZED["ğŸ§  Memory-Enhanced Specialized Learning"]
    LEARN_PROCEDURAL["âš™ï¸ Memory-Driven Procedural Learning<br/>ğŸ§  Skills learned THROUGH Memory patterns<br/>â¡ï¸ SERVES: Memory Backbone skill development"]:::learning_loop
    LEARN_DECLARATIVE["ğŸ“š Memory Backbone Declarative Learning<br/>ğŸ§  Facts integrated INTO Memory knowledge<br/>â¡ï¸ SERVES: Memory Backbone knowledge base"]:::learning_loop
    LEARN_REINFORCEMENT["ğŸ¯ Memory-Informed Reinforcement Learning<br/>ğŸ§  Rewards evaluated THROUGH Memory context<br/>â¡ï¸ SERVES: Memory Backbone reward learning"]:::learning_loop
    LEARN_SOCIAL["ğŸ¤ Memory-Enhanced Social Learning<br/>ğŸ§  Social learning FROM Memory relationships<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family Memory social intelligence<br/>â¡ï¸ SERVES: Memory Backbone social development"]:::learning_loop
  end
  subgraph MEMORY_META_LEARNING["ğŸ§  Memory-Driven Meta-Learning & Transfer"]
    LEARN_META["ğŸ­ Memory Meta-Learning<br/>ğŸ§  Learning about learning FROM Memory patterns<br/>â¡ï¸ SERVES: Memory Backbone meta-intelligence"]:::learning_loop
    LEARN_TRANSFER["ğŸ”— Memory-Based Transfer Learning<br/>ğŸ§  Knowledge transfer THROUGH Memory connections<br/>â¡ï¸ SERVES: Memory Backbone knowledge transfer"]:::learning_loop
    LEARN_CURIOSITY["ğŸ” Memory-Driven Curiosity Learning<br/>ğŸ§  Curiosity guided BY Memory gaps<br/>â¡ï¸ SERVES: Memory Backbone exploration"]:::learning_loop
  end
end
class MEMORY_LEARNING_LOOP brain

%% ====== FAMILY MEMORY-AWARE SOCIAL COGNITION ======
subgraph FAMILY_MEMORY_SOCIAL_COGNITION["ğŸ¤ Family Memory-Aware Social Cognition"]
  direction TB
  subgraph MEMORY_TOM_CORE["ğŸ§  Memory-Driven Theory of Mind Core"]
    TOM_BELIEFS["ğŸ’­ Memory-Based Belief Attribution<br/>ğŸ§  Understanding others THROUGH Memory relationships<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family belief modeling FROM Memory<br/>â¡ï¸ SERVES: Memory Backbone social understanding"]:::social_cognition
    TOM_INTENTIONS["ğŸ¯ Memory-Informed Intention Recognition<br/>ğŸ§  Intentions understood THROUGH Memory patterns<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family intention awareness FROM Memory<br/>â¡ï¸ SERVES: Memory Backbone intention intelligence"]:::social_cognition
    TOM_EMOTIONS["ğŸ’— Memory-Enhanced Emotion Attribution<br/>ğŸ§  Emotional understanding FROM Memory experiences<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family emotional intelligence THROUGH Memory<br/>â¡ï¸ SERVES: Memory Backbone emotional understanding"]:::social_cognition
    TOM_KNOWLEDGE["ğŸ“š Memory Knowledge Attribution<br/>ğŸ§  Others' knowledge modeled IN Memory Backbone<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family knowledge awareness THROUGH Memory<br/>â¡ï¸ SERVES: Memory Backbone knowledge modeling"]:::social_cognition
  end
  subgraph MEMORY_SOCIAL_REASONING["ğŸ§  Memory-Enhanced Social Reasoning"]
    SOC_NORMS["ğŸ“‹ Memory-Based Social Norms<br/>ğŸ§  Social rules learned FROM Memory experiences<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family norms stored IN Memory Backbone<br/>â¡ï¸ SERVES: Memory Backbone social intelligence"]:::social_cognition
    SOC_RELATIONS["ğŸ”— Memory Relationship Modeling<br/>ğŸ§  Relationships tracked IN Memory Backbone<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family dynamics FROM Memory patterns<br/>â¡ï¸ SERVES: Memory Backbone relationship intelligence"]:::social_cognition
    SOC_COMMUNICATION["ğŸ’¬ Memory-Informed Communication Intent<br/>ğŸ§  Communication understanding THROUGH Memory context<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family communication patterns FROM Memory<br/>â¡ï¸ SERVES: Memory Backbone communication intelligence"]:::social_cognition
    SOC_COOPERATION["ğŸ¤ Memory-Driven Cooperation & Competition<br/>ğŸ§  Social strategies FROM Memory experiences<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family cooperation patterns THROUGH Memory<br/>â¡ï¸ SERVES: Memory Backbone social coordination"]:::social_cognition
  end
  subgraph MEMORY_SOCIAL_LEARNING["ğŸ§  Memory-Enhanced Social Learning & Adaptation"]
    SOC_IMITATION["ğŸ‘¯ Memory-Informed Imitation Learning<br/>ğŸ§  Social learning THROUGH Memory examples<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family behavior learning FROM Memory<br/>â¡ï¸ SERVES: Memory Backbone social development"]:::social_cognition
    SOC_FEEDBACK["ğŸ“Š Memory Social Feedback<br/>ğŸ§  Social feedback integrated INTO Memory Backbone<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family feedback patterns IN Memory<br/>â¡ï¸ SERVES: Memory Backbone social improvement"]:::social_cognition
    SOC_PERSPECTIVE["ğŸ‘ï¸ Memory Perspective Switching<br/>ğŸ§  Perspective taking FROM Memory experiences<br/>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family perspective understanding THROUGH Memory<br/>â¡ï¸ SERVES: Memory Backbone empathy intelligence"]:::social_cognition
  end
end
class FAMILY_MEMORY_SOCIAL_COGNITION brain

%% ====== METACOGNITION ======
subgraph METACOGNITION["ğŸ§  Metacognitive Feedback Systems (aPFC + ACC)"]
  direction TB
  subgraph META_MONITORING["Metacognitive Monitoring"]
    META_CONFIDENCE["ğŸ“ˆ Confidence Assessment"]:::metacognitive
    META_PERFORMANCE["âš¡ Performance Monitoring"]:::metacognitive
    META_KNOWLEDGE["ğŸ“š Knowledge Assessment"]:::metacognitive
    META_STRATEGY["ğŸ¯ Strategy Monitoring"]:::metacognitive
  end
  subgraph META_CONTROL["Metacognitive Control"]
    META_REGULATION["ğŸ”§ Cognitive Regulation"]:::metacognitive
    META_PLANNING["ğŸ“‹ Metacognitive Planning"]:::metacognitive
    META_REFLECTION["ğŸ¤” Reflective Processing"]:::metacognitive
  end
  subgraph SELF_MODEL["Self-Model & Identity"]
    SELF_CONCEPT["ğŸ­ Self-Concept"]:::metacognitive
    SELF_EFFICACY["ğŸ’ª Self-Efficacy"]:::metacognitive
    SELF_AWARENESS["ğŸ‘ï¸ Self-Awareness"]:::metacognitive
  end
end
class METACOGNITION brain

%% ====== REWARD & MOTIVATION ======
subgraph REWARD_SYSTEMS["ğŸ”¥ Reward Systems & Motivation (VTA + Striatum)"]
  direction TB
  subgraph REWARD_CORE["Core Reward Processing"]
    REWARD_PREDICTION["ğŸ”® Reward Prediction"]:::reward_system
    REWARD_ERROR["âš¡ Prediction Error"]:::reward_system
    REWARD_VALUATION["ğŸ’° Value Assessment"]:::reward_system
  end
  subgraph MOTIVATION_SYSTEMS["Motivational Systems"]
    DRIVE_HOMEOSTASIS["âš–ï¸ Homeostatic Drives"]:::reward_system
    DRIVE_CURIOSITY["ğŸ” Curiosity Drive"]:::reward_system
    DRIVE_ACHIEVEMENT["ğŸ† Achievement Drive"]:::reward_system
    DRIVE_SOCIAL["ğŸ¤ Social Drive"]:::reward_system
  end
  subgraph INCENTIVE_PROCESSING["Incentive Processing"]
    INCENTIVE_SALIENCE["âœ¨ Incentive Salience"]:::reward_system
    INCENTIVE_LEARNING["ğŸ“ˆ Incentive Learning"]:::reward_system
    INCENTIVE_REGULATION["ğŸšï¸ Motivation Regulation"]:::reward_system
  end
end
class REWARD_SYSTEMS brain

%% ====== PROCEDURAL MEMORY & HABITS ======
subgraph PROCEDURAL_MEMORY["ğŸ§  Procedural Memory & Habits (Basal Ganglia + Motor Cortex)"]
  direction TB
  subgraph HABIT_SYSTEM["Habit Formation System"]
    HABIT_FORMATION["âš™ï¸ Habit Formation"]:::procedural_memory
    HABIT_EXECUTION["ğŸƒ Habit Execution"]:::procedural_memory
    HABIT_MODIFICATION["ğŸ”§ Habit Modification"]:::procedural_memory
  end
  subgraph SKILL_LEARNING["Skill Learning & Motor Programs"]
    SKILL_ACQUISITION["ğŸ“š Skill Acquisition"]:::procedural_memory
    SKILL_REFINEMENT["âœ¨ Skill Refinement"]:::procedural_memory
    SKILL_TRANSFER["ğŸ”— Skill Transfer"]:::procedural_memory
  end
  subgraph ACTION_CONTROL["Action Selection & Control"]
    ACT_SELECT["âš–ï¸ Action Selection"]:::procedural_memory
    ACT_INHIBIT["ğŸ›‘ Action Inhibition"]:::procedural_memory
    ACT_SWITCH["ğŸ”„ Action Switching"]:::procedural_memory
  end
end
class PROCEDURAL_MEMORY brain

%% ====== IMAGINATION & SIMULATION ======
subgraph IMAGINATION["ğŸ§  Imagination & Simulation (Default Mode Network)"]
  direction TB
  subgraph SIMULATION_ENGINE["Mental Simulation Engine"]
    SIM_FORWARD["ğŸ”® Forward Simulation"]:::brain
    SIM_COUNTERFACTUAL["ğŸ” Counterfactual Thinking"]:::brain
    SIM_EPISODIC["ğŸ“… Episodic Simulation"]:::brain
  end
  subgraph CREATIVE_PROCESSES["Creative & Generative Processes"]
    CREATIVITY_DIVERGENT["ğŸŒŸ Divergent Thinking"]:::brain
    CREATIVITY_CONVERGENT["ğŸ¯ Convergent Thinking"]:::brain
    CREATIVITY_INSIGHT["ğŸ’¡ Insight Generation"]:::brain
  end
  subgraph DREAMING["Dreaming & Offline Processing"]
    DREAM_CONSOLIDATION["ğŸ’¾ Memory Consolidation"]:::brain
    DREAM_EXPLORATION["ğŸ” Explorative Dreaming"]:::brain
    DREAM_REHEARSAL["ğŸ­ Mental Rehearsal"]:::brain
  end
end
class IMAGINATION brain

%% ====== ACTION & ARBITRATION (ADVISORY ONLY â†’ P04) ======
subgraph ACTION_SYSTEMS["ğŸ® Action Systems (Advisory Signals Only)"]
  direction TB
  subgraph ACTION_PLANNING["Action Planning (advisory)"]
    ACTION_GOALS["ğŸ¯ Goal Formation (signals â†’ P04)"]:::action_selection
    ACTION_PLAN_NODE["ğŸ“‹ Action Planning (signals â†’ P04)"]:::action_selection
    ACTION_COORD_ADVISORY["âš¡ Coordination Advisory (signals â†’ P04)"]:::action_selection
  end
  subgraph MOTOR_LEARNING["Motor Learning & Adaptation"]
    MOTOR_ACQUISITION["ğŸ“š Motor Acquisition"]:::action_selection
    MOTOR_ADAPTATION["ğŸ”„ Motor Adaptation"]:::action_selection
    MOTOR_EXPERTISE["â­ Motor Expertise"]:::action_selection
  end
  subgraph ACTION_MONITORING["Action Monitoring & Control"]
    ACTION_FEEDBACK["ğŸ“ˆ Action Feedback"]:::action_selection
    ACT_INHIBIT_SIGNAL["ğŸ›‘ Inhibition Signal (monitor)"]:::action_selection
    ACTION_OUTCOMES["ğŸ¯ Outcome Evaluation"]:::action_selection
  end
end
class ACTION_SYSTEMS brain

subgraph ARBITRATION["âš–ï¸ Arbitration & Decision (Advisory â†’ P04)"]
  direction TB
  subgraph DECISION_CORE["Decision Architecture (advisory)"]
    DECISION_OPTIONS["ğŸ“‹ Option Generation (â†’ P04)"]:::action_selection
    DECISION_EVALUATION["ğŸ“Š Option Evaluation (â†’ P04)"]:::action_selection
    DECISION_SELECTION["âš¡ Decision Recommendation (â†’ P04)"]:::action_selection
  end
  subgraph STRATEGIC_PLANNING["Strategic Planning (advisory)"]
    PLAN_FORMATION["ğŸ“‹ Plan Formation (â†’ P04)"]:::action_selection
    PLAN_EXECUTION["âš¡ Plan Monitoring (â†’ P04)"]:::action_selection
    PLAN_MONITORING["ğŸ“Š Plan Assessment (â†’ P04)"]:::action_selection
  end
  subgraph CONFLICT_RESOLUTION["Conflict Resolution & Control"]
    CONFLICT_DETECTION["âš ï¸ Conflict Detection"]:::action_selection
    CONFLICT_ARBITRATION["âš–ï¸ Conflict Arbitration"]:::action_selection
    COGNITIVE_CONTROL["ğŸ® Cognitive Control"]:::action_selection
  end
end
class ARBITRATION brain

%% ====== AFFECT & EMOTIONAL INTELLIGENCE ======
subgraph AFFECT_INTELLIGENCE["ğŸ’– Affect & Emotional Intelligence"]
  direction TB
  subgraph EMOTION_CORE["Emotional Processing Core"]
    EMOTION_RECOGNITION["ğŸ­ Emotion Recognition"]:::social_cognition
    EMOTION_GENERATION["âš¡ Emotion Generation"]:::social_cognition
    EMOTION_REGULATION["ğŸšï¸ Emotion Regulation"]:::social_cognition
  end
  subgraph SOCIAL_EMOTION["Social Emotional Intelligence"]
    EMPATHY["ğŸ’ Empathy Systems"]:::social_cognition
    EMOTIONAL_COMMUNICATION["ğŸ’¬ Emotional Communication"]:::social_cognition
    EMOTIONAL_MEMORY["ğŸ“š Emotional Memory"]:::social_cognition
  end
end
class AFFECT_INTELLIGENCE brain

%% ====== INTELLIGENCE STORAGE & EVENTS ======
subgraph INTELLIGENCE_STORAGE["ğŸ’¾ Intelligence Storage & Events (cognitive_trace_id)"]
  direction TB
  subgraph STORAGE_SYSTEMS["Specialized Storage"]
    ST_LEARNING["ğŸ“š Learning Store"]:::storage
    ST_SOCIAL["ğŸ¤ Social Store"]:::storage
    ST_METACOG["ğŸª Metacognitive Store"]:::storage
    ST_PROCEDURAL["âš™ï¸ Procedural Store"]:::storage
  end
  subgraph INTELLIGENCE_EVENTS["ğŸ“¡ intelligence.* events (trace_id correlation)"]
    EV_LEARNING["ğŸ“ˆ intelligence.learning.*"]:::bus
    EV_SOCIAL["ğŸ¤ intelligence.social.*"]:::bus
    EV_METACOG["ğŸª intelligence.metacog.*"]:::bus
    EV_DECISION["âš–ï¸ intelligence.decision.*"]:::bus
  end
end
class INTELLIGENCE_STORAGE card

%% ====== INTELLIGENCE GUARDS (Policy/Safety/QoS for advisory) ======
subgraph INTELLIGENCE_GUARDS["ğŸ›¡ï¸ Intelligence Guards (advisory only)"]
  INT_POLICY_GUARD["policy/intelligence_guard.py<br/>ABAC/consent/redaction (advisory)"]:::gate
  INT_QOS_GUARD["retrieval/qos_gate.py (budget on planning/advice)"]:::smart
  INT_SAFETY_MON["policy/safety.py (harm/abuse heuristics on advice)"]:::smart
end
class INTELLIGENCE_GUARDS card

%% ====== INTELLIGENCE TOPICS (bus bridge like Diagram 1) ======
subgraph INTELLIGENCE_TOPICS["ğŸ“¡ intelligence.* topics (trace_id)"]
  INT_T["intelligence.* (generic)"]:::bus
  INT_ADVISORY_T["intelligence.advisory.* (to P04)"]:::bus
  INT_TRACE_T["intelligence.trace.* (observability)"]:::bus
end
class INTELLIGENCE_TOPICS card

%% ====== EXTERNAL ANCHORS to match Pipelines & SSE ======
subgraph PIPELINE_ANCHORS["ğŸ”— Pipeline & SSE anchors"]
  %% TO_P04_ACTIONS already defined in MEMORY_BACKBONE_CONNECTIONS
  TO_P05_PROSPECTIVE["â†’ P05 Prospective/Triggers (advisory)"]:::bus
  TO_P06_LEARNING["â†’ P06 Learning/Neuromod (signals)"]:::bus
  TO_P17_QOS["â†’ P17 QoS/Cost Governance (budgets)"]:::bus
  TO_P18_SAFETY["â†’ P18 Safety/Abuse (policy hooks)"]:::bus
  FROM_P19_PROFILE["â† P19 Personalization/Reco (profiles)"]:::bus
  TO_SSE_INTELLIGENCE["â†’ SSE ACL: intelligence.* (sanitized)"]:::plane
  FROM_WORKSPACE["â† workspace.* (Global Workspace broadcast)"]:::bus
end
class PIPELINE_ANCHORS card

%% ====== WIRING: Advice path â†’ guards â†’ topics â†’ P04 ======
DECISION_SELECTION-->INT_POLICY_GUARD-->INT_QOS_GUARD-->INT_SAFETY_MON-->INT_ADVISORY_T
ACTION_COORD_ADVISORY-->INT_POLICY_GUARD
ACT_SELECT-->INT_POLICY_GUARD
INT_ADVISORY_T-->TO_P04_ACTIONS

%% ====== WIRING: Learning, Prospective, QoS, Safety integration ======
LEARN_ADAPT-->TO_P06_LEARNING
META_PLANNING-->TO_P05_PROSPECTIVE
PLAN_FORMATION-->TO_P05_PROSPECTIVE
INT_COORDINATOR-->TO_P17_QOS
INT_SAFETY_MON-->TO_P18_SAFETY

%% ====== WIRING: Personalization influence ======
FROM_P19_PROFILE-->DECISION_EVALUATION
FROM_P19_PROFILE-->REWARD_VALUATION

%% ====== WIRING: SSE exposure & tracing ======
EV_LEARNING-->INT_T
EV_SOCIAL-->INT_T
EV_METACOG-->INT_T
EV_DECISION-->INT_T
INT_EVENT_PROCESSOR-->INT_T & INT_TRACE_T
INT_T-->TO_SSE_INTELLIGENCE
INT_TRACE_T-->TO_INFRASTRUCTURE
%% flows into observability/receipts stack

%% ====== WIRING: Explicit workspace inputs ======
FROM_WORKSPACE-->INT_MEMORY_MANAGER
FROM_WORKSPACE-->DECISION_SELECTION

%% ====== WIRING (normalized; keeps original intent) ======

%% Memory Backbone inputs to intelligence systems
FROM_MEMORY_BACKBONE-->INT_COORDINATOR
FROM_MEMORY_BACKBONE-->LEARN_COORDINATOR
FROM_COGNITIVE_CORE-->META_CONFIDENCE
FROM_COGNITIVE_CORE-->TOM_BELIEFS
FROM_MEMORY_BACKBONE-->INT_COORDINATOR
FROM_MEMORY_BACKBONE-->ACTION_GOALS

%% Learning core loop
LEARN_COORDINATOR-->LEARN_PREDICT-->LEARN_ADAPT-->LEARN_FEEDBACK-->LEARN_COORDINATOR
LEARN_FEEDBACK-->REWARD_PREDICTION
LEARN_FEEDBACK-->META_PERFORMANCE
LEARN_ADAPT-->ACT_SELECT
LEARN_ADAPT-->HABIT_MODIFICATION

%% Specialized learning
LEARN_COORDINATOR-->LEARN_PROCEDURAL & LEARN_DECLARATIVE & LEARN_REINFORCEMENT & LEARN_SOCIAL
LEARN_PROCEDURAL-->HABIT_FORMATION & SKILL_ACQUISITION
LEARN_REINFORCEMENT-->REWARD_PREDICTION & INCENTIVE_LEARNING
LEARN_SOCIAL-->SOC_IMITATION
SOC_IMITATION-->TOM_BELIEFS

%% Meta-learning
LEARN_META-->LEARN_TRANSFER-->LEARN_CURIOSITY
LEARN_CURIOSITY-->DRIVE_CURIOSITY & SIM_FORWARD
LEARN_TRANSFER-->CREATIVITY_INSIGHT & SKILL_TRANSFER

%% Social cognition
TOM_BELIEFS-->TOM_INTENTIONS-->TOM_EMOTIONS-->TOM_KNOWLEDGE
SOC_NORMS<-->SOC_RELATIONS<-->SOC_COMMUNICATION<-->SOC_COOPERATION
SOC_FEEDBACK-->EV_SOCIAL
TOM_BELIEFS-->DECISION_EVALUATION
TOM_BELIEFS-->EMPATHY

%% Metacognition
META_CONFIDENCE-->META_PERFORMANCE-->META_KNOWLEDGE-->META_STRATEGY
META_REGULATION-->META_PLANNING-->META_REFLECTION
SELF_CONCEPT<-->SELF_EFFICACY<-->SELF_AWARENESS
META_PERFORMANCE-->LEARN_FEEDBACK
META_PERFORMANCE-->CONFLICT_DETECTION

%% Reward & motivation
REWARD_PREDICTION-->REWARD_ERROR-->REWARD_VALUATION
DRIVE_HOMEOSTASIS & DRIVE_CURIOSITY & DRIVE_ACHIEVEMENT & DRIVE_SOCIAL-->INCENTIVE_SALIENCE
INCENTIVE_SALIENCE-->INCENTIVE_LEARNING-->INCENTIVE_REGULATION
REWARD_ERROR-->LEARN_REINFORCEMENT
REWARD_ERROR-->ACTION_OUTCOMES

%% Procedural/habits
HABIT_FORMATION-->HABIT_EXECUTION-->HABIT_MODIFICATION
SKILL_ACQUISITION-->SKILL_REFINEMENT-->SKILL_TRANSFER
ACT_SELECT<-->ACT_INHIBIT<-->ACT_SWITCH
HABIT_EXECUTION-->ACTION_COORD_ADVISORY
HABIT_EXECUTION-->MOTOR_ACQUISITION

%% Imagination
SIM_FORWARD<-->SIM_COUNTERFACTUAL<-->SIM_EPISODIC
CREATIVITY_DIVERGENT<-->CREATIVITY_CONVERGENT-->CREATIVITY_INSIGHT
DREAM_CONSOLIDATION<-->DREAM_EXPLORATION<-->DREAM_REHEARSAL
SIM_FORWARD-->DECISION_EVALUATION
SIM_FORWARD-->PLAN_FORMATION

%% Action (advisory only)
ACTION_GOALS-->ACTION_PLAN_NODE-->ACTION_COORD_ADVISORY-->ACTION_FEEDBACK
MOTOR_ACQUISITION-->MOTOR_ADAPTATION-->MOTOR_EXPERTISE
ACTION_FEEDBACK-->ACT_INHIBIT_SIGNAL & ACTION_OUTCOMES
ACT_SELECT-->ACTION_COORD_ADVISORY
ACT_SELECT-->ACT_INHIBIT

%% Arbitration (advisory only)
DECISION_OPTIONS-->DECISION_EVALUATION-->DECISION_SELECTION
PLAN_FORMATION-->PLAN_EXECUTION-->PLAN_MONITORING
CONFLICT_DETECTION-->CONFLICT_ARBITRATION-->COGNITIVE_CONTROL
DECISION_EVALUATION<-->REWARD_VALUATION & META_CONFIDENCE

%% Affect
EMOTION_RECOGNITION-->EMOTION_GENERATION-->EMOTION_REGULATION
EMPATHY<-->EMOTIONAL_COMMUNICATION<-->EMOTIONAL_MEMORY
EMOTION_REGULATION-->META_REGULATION & COGNITIVE_CONTROL
EMPATHY-->TOM_EMOTIONS & SOC_COOPERATION

%% Coordination, storage, events
INT_COORDINATOR<-->LEARN_COORDINATOR & META_REGULATION & DECISION_SELECTION
INT_MEMORY_MANAGER<-->EMOTIONAL_MEMORY & ST_LEARNING & ST_SOCIAL
INT_EVENT_PROCESSOR<-->EV_LEARNING & EV_SOCIAL & EV_METACOG & EV_DECISION

LEARN_FEEDBACK-->ST_LEARNING
SOC_RELATIONS-->ST_SOCIAL
META_PERFORMANCE-->ST_METACOG
SKILL_ACQUISITION-->ST_PROCEDURAL

LEARN_ADAPT-->EV_LEARNING
SOC_FEEDBACK-->EV_SOCIAL
META_REFLECTION-->EV_METACOG
DECISION_SELECTION-->EV_DECISION

%% Legacy integration
LEG_SOCIAL<-->TOM_BELIEFS & SOC_NORMS
LEG_METACOG<-->META_CONFIDENCE & META_PERFORMANCE
LEG_DRIVES<-->DRIVE_HOMEOSTASIS & REWARD_PREDICTION
LEG_AFFECT<-->EMOTION_RECOGNITION & EMPATHY
LEG_ACTION<-->ACTION_COORD_ADVISORY & MOTOR_ACQUISITION
LEG_LEARNING<-->LEARN_COORDINATOR & LEARN_REINFORCEMENT
LEG_IMAGINATION<-->SIM_FORWARD & CREATIVITY_DIVERGENT

%% Cross-diagram advisory outputs
LEARN_COORDINATOR-->TO_P04_ACTIONS
META_REFLECTION-->TO_P04_ACTIONS
DECISION_SELECTION-->TO_P04_ACTIONS
DREAM_CONSOLIDATION-->TO_P04_ACTIONS
INT_EVENT_PROCESSOR-->TO_P04_ACTIONS
