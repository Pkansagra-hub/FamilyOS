openapi: 3.1.0
info:
  title: MemoryOS User Authentication & Sessions Contract
  version: "1.0.0"
  description: |
    **Memory-Centric Family AI Authentication & Session Management Contract**

    This contract defines the authentication and session management capabilities for the
    Memory-Centric Family AI system, providing secure authentication with cognitive integration,
    family device coordination, multi-factor authentication, and memory-based trust systems.

    **Memory-Driven Authentication Architecture:**
    - **Memory Backbone Authentication Core**: Authentication coordinated through memory experiences
    - **Memory-Enhanced Cognitive Identity**: Identity verification with cognitive patterns
    - **Memory-Driven Family Device Trust**: Device authentication through family memory context
    - **Family Memory Session Coordination**: Session management with family-wide coordination
    - **Memory-Based Security Adaptation**: Security measures adapted through memory patterns

    **Authentication Categories:**
    1. **Memory-Informed Identity Verification**: Identity verification through memory patterns
    2. **Memory-Driven Multi-Factor Authentication**: MFA with family context and memory insights
    3. **Memory-Enhanced Session Management**: Sessions coordinated through family memory
    4. **Memory-Based Device Trust**: Device authentication with memory-driven trust levels
    5. **Memory-Coordinated Family Authentication**: Family-wide authentication coordination
    6. **Memory-Driven Security Monitoring**: Security monitoring with memory-based analysis
    7. **Memory-Enhanced Recovery & Reset**: Account recovery with family and memory verification

    **Family Intelligence Integration:**
    - Authentication coordinated through family memory backbone
    - Session management with family device coordination
    - Security measures adapted through family relationship patterns
    - Recovery processes with family verification and memory validation

servers:
  - url: https://api.memoryos.family/v1
    description: MemoryOS Family AI Authentication API

paths:
  /auth/login:
    post:
      summary: Initiate Memory-Enhanced Authentication
      description: |
        Initiate authentication with memory-driven verification,
        family context awareness, and cognitive pattern recognition.
      operationId: initiateMemoryEnhancedAuthentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Authentication initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthenticationInitiationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          description: Authentication failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthenticationFailureResponse'
        '423':
          description: Account temporarily locked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountLockResponse'

  /auth/mfa/verify:
    post:
      summary: Verify Multi-Factor Authentication with Memory Context
      description: |
        Verify multi-factor authentication with family context validation,
        memory pattern verification, and cognitive confirmation.
      operationId: verifyMFAWithMemoryContext
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MFAVerificationRequest'
      responses:
        '200':
          description: MFA verification successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MFAVerificationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          description: MFA verification failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MFAFailureResponse'

  /auth/device/trust:
    post:
      summary: Establish Device Trust with Family Memory Context
      description: |
        Establish device trust with family memory context validation,
        device fingerprinting, and family-wide trust coordination.
      operationId: establishDeviceTrustWithFamilyMemoryContext
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceTrustRequest'
      responses:
        '201':
          description: Device trust established successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceTrustResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          description: Device trust establishment denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceTrustDenialResponse'

  /auth/sessions:
    get:
      summary: Get Memory-Coordinated Active Sessions
      description: |
        Retrieve active sessions with memory-driven insights,
        family device coordination status, and session analytics.
      operationId: getMemoryCoordinatedActiveSessions
      security:
        - BearerAuth: []
      parameters:
        - name: include_family_sessions
          in: query
          schema:
            type: boolean
            default: false
          description: Include family member session information
        - name: include_session_analytics
          in: query
          schema:
            type: boolean
            default: true
          description: Include session analytics and insights
      responses:
        '200':
          description: Active sessions retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActiveSessionsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

    delete:
      summary: Terminate All Sessions with Family Coordination
      description: |
        Terminate all active sessions with family coordination,
        memory context cleanup, and security notification.
      operationId: terminateAllSessionsWithFamilyCoordination
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionTerminationRequest'
      responses:
        '200':
          description: All sessions terminated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionTerminationResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/sessions/{sessionId}:
    get:
      summary: Get Memory-Enhanced Session Details
      description: |
        Retrieve detailed session information with memory-driven insights,
        family context, and security analysis.
      operationId: getMemoryEnhancedSessionDetails
      security:
        - BearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique session identifier
      responses:
        '200':
          description: Session details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionDetailsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: Terminate Specific Session with Memory Cleanup
      description: |
        Terminate specific session with memory context cleanup,
        family coordination notification, and security logging.
      operationId: terminateSpecificSessionWithMemoryCleanup
      security:
        - BearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique session identifier
      responses:
        '200':
          description: Session terminated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SingleSessionTerminationResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /auth/refresh:
    post:
      summary: Refresh Session with Memory Validation
      description: |
        Refresh authentication session with memory pattern validation,
        family context verification, and cognitive consistency checks.
      operationId: refreshSessionWithMemoryValidation
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionRefreshRequest'
      responses:
        '200':
          description: Session refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionRefreshResponse'
        '401':
          description: Session refresh failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionRefreshFailureResponse'

  /auth/logout:
    post:
      summary: Logout with Family Memory Coordination
      description: |
        Logout with family memory context cleanup,
        session termination, and coordination notification.
      operationId: logoutWithFamilyMemoryCoordination
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '200':
          description: Logout completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogoutResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/password/reset/initiate:
    post:
      summary: Initiate Password Reset with Family Verification
      description: |
        Initiate password reset with family member verification,
        memory pattern validation, and multi-channel verification.
      operationId: initiatePasswordResetWithFamilyVerification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetInitiationRequest'
      responses:
        '200':
          description: Password reset initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetInitiationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: User not found
        '429':
          description: Too many reset attempts

  /auth/password/reset/verify:
    post:
      summary: Verify Password Reset with Memory Validation
      description: |
        Verify password reset with memory pattern validation,
        family verification confirmation, and security checks.
      operationId: verifyPasswordResetWithMemoryValidation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetVerificationRequest'
      responses:
        '200':
          description: Password reset verification successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetVerificationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          description: Reset verification failed
        '410':
          description: Reset token expired

  /auth/password/reset/complete:
    post:
      summary: Complete Password Reset with Family Notification
      description: |
        Complete password reset with new password setup,
        family notification, and security measure updates.
      operationId: completePasswordResetWithFamilyNotification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetCompletionRequest'
      responses:
        '200':
          description: Password reset completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetCompletionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          description: Reset completion failed
        '410':
          description: Reset session expired

  /auth/security/monitoring:
    get:
      summary: Get Memory-Driven Security Monitoring
      description: |
        Retrieve security monitoring information with memory-driven analysis,
        family context insights, and threat detection results.
      operationId: getMemoryDrivenSecurityMonitoring
      security:
        - BearerAuth: []
      parameters:
        - name: time_range
          in: query
          schema:
            type: string
            enum: [hour, day, week, month]
            default: day
          description: Time range for security monitoring data
        - name: include_family_context
          in: query
          schema:
            type: boolean
            default: true
          description: Include family security context
      responses:
        '200':
          description: Security monitoring data retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecurityMonitoringResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    LoginRequest:
      type: object
      required:
        - identifier
        - credential
      properties:
        identifier:
          type: string
          description: Email, username, or user ID
        credential:
          type: string
          format: password
          description: Password or authentication credential
        device_info:
          $ref: '#/components/schemas/DeviceInfo'
        remember_device:
          type: boolean
          default: false
          description: Remember this device for future logins
        family_context_hint:
          type: string
          description: Family context hint for authentication
        cognitive_challenge_response:
          type: string
          description: Response to cognitive challenge if required

    DeviceInfo:
      type: object
      properties:
        device_id:
          type: string
          description: Unique device identifier
        device_type:
          type: string
          enum: [smartphone, tablet, laptop, desktop, smart_speaker, smart_display, wearable, other]
          description: Type of device
        device_fingerprint:
          type: object
          description: Device fingerprint information
        location_info:
          $ref: '#/components/schemas/LocationInfo'
        trust_indicators:
          type: array
          items:
            type: string
          description: Device trust indicators

    LocationInfo:
      type: object
      properties:
        ip_address:
          type: string
          description: Client IP address
        geolocation:
          type: object
          description: Approximate geolocation information
        timezone:
          type: string
          description: Device timezone
        network_info:
          type: object
          description: Network information

    AuthenticationInitiationResponse:
      type: object
      required:
        - auth_session_id
        - status
        - next_steps
      properties:
        auth_session_id:
          type: string
          format: uuid
          description: Authentication session identifier
        status:
          type: string
          enum: [success, mfa_required, device_verification_required, cognitive_challenge_required, family_verification_required]
          description: Authentication status
        next_steps:
          type: array
          items:
            type: string
          description: Required next steps for authentication
        session_token:
          type: string
          description: Session token (if authentication complete)
        mfa_challenge:
          $ref: '#/components/schemas/MFAChallenge'
        device_verification_challenge:
          $ref: '#/components/schemas/DeviceVerificationChallenge'
        cognitive_challenge:
          $ref: '#/components/schemas/CognitiveChallenge'
        family_verification_challenge:
          $ref: '#/components/schemas/FamilyVerificationChallenge'
        memory_integration_status:
          type: object
          description: Memory integration status for session

    MFAChallenge:
      type: object
      properties:
        challenge_type:
          type: string
          enum: [totp, sms, email, push_notification, hardware_key, biometric, family_verification]
          description: Type of MFA challenge
        challenge_data:
          type: object
          description: Challenge-specific data
        expiration_time:
          type: string
          format: date-time
          description: Challenge expiration time
        family_context:
          type: object
          description: Family context for MFA challenge

    DeviceVerificationChallenge:
      type: object
      properties:
        verification_method:
          type: string
          enum: [email_link, sms_code, family_approval, trusted_device_confirmation]
          description: Device verification method
        challenge_data:
          type: object
          description: Verification challenge data
        family_approval_required:
          type: boolean
          description: Whether family approval is required
        trusted_devices:
          type: array
          items:
            type: object
          description: Available trusted devices for verification

    CognitiveChallenge:
      type: object
      properties:
        challenge_type:
          type: string
          enum: [memory_pattern, behavioral_biometric, family_context, preference_verification]
          description: Type of cognitive challenge
        challenge_questions:
          type: array
          items:
            type: object
          description: Cognitive challenge questions
        memory_context_required:
          type: boolean
          description: Whether memory context is required
        family_interaction_context:
          type: object
          description: Family interaction context for challenge

    FamilyVerificationChallenge:
      type: object
      properties:
        verification_type:
          type: string
          enum: [family_member_approval, shared_memory_verification, relationship_confirmation]
          description: Type of family verification
        approving_family_members:
          type: array
          items:
            type: object
          description: Family members who can approve
        shared_memory_questions:
          type: array
          items:
            type: object
          description: Shared memory verification questions
        approval_timeout:
          type: string
          format: date-time
          description: Approval request timeout

    AuthenticationFailureResponse:
      type: object
      properties:
        error_code:
          type: string
          description: Specific authentication error code
        message:
          type: string
          description: Human-readable error message
        failure_reason:
          type: string
          enum: [invalid_credentials, account_locked, device_not_trusted, family_verification_failed, cognitive_challenge_failed]
          description: Reason for authentication failure
        retry_allowed:
          type: boolean
          description: Whether retry is allowed
        lockout_duration:
          type: integer
          description: Account lockout duration in seconds
        security_actions_taken:
          type: array
          items:
            type: string
          description: Security actions taken due to failure

    AccountLockResponse:
      type: object
      properties:
        lock_reason:
          type: string
          description: Reason for account lock
        lock_duration:
          type: integer
          description: Lock duration in seconds
        unlock_methods:
          type: array
          items:
            type: string
          description: Available unlock methods
        family_notification_sent:
          type: boolean
          description: Whether family members were notified
        security_contact_info:
          type: object
          description: Security contact information

    MFAVerificationRequest:
      type: object
      required:
        - auth_session_id
        - mfa_code
      properties:
        auth_session_id:
          type: string
          format: uuid
          description: Authentication session identifier
        mfa_code:
          type: string
          description: MFA verification code
        mfa_method:
          type: string
          enum: [totp, sms, email, push_notification, hardware_key, biometric, family_verification]
          description: MFA method used
        device_binding_consent:
          type: boolean
          description: Consent to bind device for future authentication
        family_verification_data:
          type: object
          description: Family verification data if applicable

    MFAVerificationResponse:
      type: object
      required:
        - verification_status
      properties:
        verification_status:
          type: string
          enum: [success, failed, expired, retry_allowed]
          description: MFA verification status
        session_token:
          type: string
          description: Session token (if verification successful)
        session_details:
          $ref: '#/components/schemas/SessionDetails'
        device_trust_established:
          type: boolean
          description: Whether device trust was established
        family_notification_status:
          type: object
          description: Family notification status
        next_authentication_requirements:
          type: object
          description: Requirements for next authentication

    MFAFailureResponse:
      type: object
      properties:
        failure_reason:
          type: string
          enum: [invalid_code, expired_code, method_unavailable, family_rejection, security_lockout]
          description: Reason for MFA failure
        remaining_attempts:
          type: integer
          description: Remaining verification attempts
        alternative_methods:
          type: array
          items:
            type: string
          description: Alternative MFA methods available
        lockout_warning:
          type: boolean
          description: Whether user is close to lockout
        family_escalation_available:
          type: boolean
          description: Whether family escalation is available

    DeviceTrustRequest:
      type: object
      required:
        - session_token
        - device_info
      properties:
        session_token:
          type: string
          description: Current session token
        device_info:
          $ref: '#/components/schemas/DeviceInfo'
        trust_level_requested:
          type: string
          enum: [basic, standard, enhanced, family_coordinator]
          description: Requested device trust level
        family_approval_consent:
          type: boolean
          description: Consent for family approval if required
        biometric_data:
          type: object
          description: Biometric data for device binding
        security_preferences:
          type: object
          description: Security preferences for device

    DeviceTrustResponse:
      type: object
      required:
        - device_trust_id
        - trust_level_granted
        - status
      properties:
        device_trust_id:
          type: string
          format: uuid
          description: Device trust identifier
        trust_level_granted:
          type: string
          enum: [basic, standard, enhanced, family_coordinator]
          description: Granted device trust level
        status:
          type: string
          enum: [established, pending_family_approval, requires_verification, denied]
          description: Device trust establishment status
        trust_expiration:
          type: string
          format: date-time
          description: Trust expiration date
        family_approval_status:
          type: object
          description: Family approval status
        security_measures_enabled:
          type: array
          items:
            type: string
          description: Security measures enabled for device

    DeviceTrustDenialResponse:
      type: object
      properties:
        denial_reason:
          type: string
          enum: [device_risk_assessment, family_policy_violation, security_concern, insufficient_verification]
          description: Reason for device trust denial
        risk_factors:
          type: array
          items:
            type: string
          description: Identified risk factors
        remediation_steps:
          type: array
          items:
            type: string
          description: Steps to remediate trust issues
        appeal_process:
          type: object
          description: Trust denial appeal process information

    ActiveSessionsResponse:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
          description: User identifier
        active_sessions:
          type: array
          items:
            $ref: '#/components/schemas/SessionSummary'
          description: List of active sessions
        family_sessions_summary:
          type: object
          description: Family sessions summary (if requested)
        session_analytics:
          type: object
          description: Session analytics and insights
        security_recommendations:
          type: array
          items:
            type: string
          description: Security recommendations based on session analysis

    SessionSummary:
      type: object
      properties:
        session_id:
          type: string
          format: uuid
          description: Session identifier
        device_info:
          $ref: '#/components/schemas/DeviceInfo'
        created_at:
          type: string
          format: date-time
          description: Session creation time
        last_activity:
          type: string
          format: date-time
          description: Last activity time
        expires_at:
          type: string
          format: date-time
          description: Session expiration time
        trust_level:
          type: string
          enum: [basic, standard, enhanced, family_coordinator]
          description: Session trust level
        location_info:
          $ref: '#/components/schemas/LocationInfo'
        family_coordination_status:
          type: string
          enum: [active, limited, disabled]
          description: Family coordination status for session

    SessionTerminationRequest:
      type: object
      properties:
        termination_reason:
          type: string
          description: Reason for session termination
        notify_family:
          type: boolean
          default: true
          description: Whether to notify family members
        security_clearance_level:
          type: string
          enum: [standard, enhanced, complete]
          default: standard
          description: Level of security clearance required

    SessionTerminationResponse:
      type: object
      properties:
        terminated_sessions:
          type: array
          items:
            type: string
          description: List of terminated session IDs
        family_notification_status:
          type: object
          description: Family notification status
        security_clearance_completed:
          type: boolean
          description: Whether security clearance was completed
        next_authentication_requirements:
          type: object
          description: Requirements for next authentication

    SessionDetails:
      type: object
      properties:
        session_id:
          type: string
          format: uuid
          description: Session identifier
        user_id:
          type: string
          format: uuid
          description: User identifier
        device_details:
          $ref: '#/components/schemas/DeviceInfo'
        authentication_details:
          type: object
          description: Authentication method and details
        session_timeline:
          type: object
          description: Session activity timeline
        security_events:
          type: array
          items:
            type: object
          description: Security events during session
        family_coordination_history:
          type: object
          description: Family coordination activity history
        memory_integration_activity:
          type: object
          description: Memory integration activity during session
        trust_score:
          type: number
          description: Current session trust score
        risk_assessment:
          type: object
          description: Ongoing risk assessment

    SessionDetailsResponse:
      type: object
      properties:
        session_details:
          $ref: '#/components/schemas/SessionDetails'
        related_sessions:
          type: array
          items:
            $ref: '#/components/schemas/SessionSummary'
          description: Related family sessions
        security_insights:
          type: object
          description: Security insights for session
        recommendations:
          type: array
          items:
            type: string
          description: Security and usage recommendations

    SingleSessionTerminationResponse:
      type: object
      properties:
        session_id:
          type: string
          format: uuid
          description: Terminated session identifier
        termination_status:
          type: string
          enum: [success, failed, partial]
          description: Termination operation status
        cleanup_completed:
          type: boolean
          description: Whether session cleanup was completed
        family_notification_sent:
          type: boolean
          description: Whether family notification was sent
        security_log_updated:
          type: boolean
          description: Whether security log was updated

    SessionRefreshRequest:
      type: object
      properties:
        refresh_token:
          type: string
          description: Refresh token
        extend_duration:
          type: boolean
          default: false
          description: Whether to extend session duration
        update_device_info:
          type: boolean
          default: true
          description: Whether to update device information
        memory_validation_required:
          type: boolean
          default: true
          description: Whether memory validation is required

    SessionRefreshResponse:
      type: object
      required:
        - new_session_token
        - refresh_status
      properties:
        new_session_token:
          type: string
          description: New session token
        refresh_token:
          type: string
          description: New refresh token
        refresh_status:
          type: string
          enum: [success, partial, validation_required, expired]
          description: Refresh operation status
        session_details:
          $ref: '#/components/schemas/SessionDetails'
        memory_validation_status:
          type: object
          description: Memory validation status
        family_coordination_updated:
          type: boolean
          description: Whether family coordination was updated

    SessionRefreshFailureResponse:
      type: object
      properties:
        failure_reason:
          type: string
          enum: [expired_token, invalid_token, security_violation, memory_validation_failed, device_trust_revoked]
          description: Reason for refresh failure
        reauth_required:
          type: boolean
          description: Whether re-authentication is required
        security_actions_taken:
          type: array
          items:
            type: string
          description: Security actions taken due to failure
        family_notification_sent:
          type: boolean
          description: Whether family was notified of failure

    LogoutRequest:
      type: object
      properties:
        logout_all_devices:
          type: boolean
          default: false
          description: Whether to logout from all devices
        clear_memory_context:
          type: boolean
          default: false
          description: Whether to clear memory context
        notify_family:
          type: boolean
          default: true
          description: Whether to notify family members
        logout_reason:
          type: string
          description: Reason for logout

    LogoutResponse:
      type: object
      properties:
        logout_status:
          type: string
          enum: [success, partial, failed]
          description: Logout operation status
        sessions_terminated:
          type: array
          items:
            type: string
          description: List of terminated session IDs
        memory_context_cleared:
          type: boolean
          description: Whether memory context was cleared
        family_notification_sent:
          type: boolean
          description: Whether family notification was sent
        security_log_updated:
          type: boolean
          description: Whether security log was updated

    PasswordResetInitiationRequest:
      type: object
      required:
        - identifier
      properties:
        identifier:
          type: string
          description: Email, username, or user ID
        reset_method:
          type: string
          enum: [email, sms, family_verification, security_questions]
          description: Preferred reset method
        device_info:
          $ref: '#/components/schemas/DeviceInfo'
        family_verification_consent:
          type: boolean
          description: Consent for family member verification
        memory_challenge_consent:
          type: boolean
          description: Consent for memory-based challenges

    PasswordResetInitiationResponse:
      type: object
      required:
        - reset_session_id
        - status
      properties:
        reset_session_id:
          type: string
          format: uuid
          description: Password reset session identifier
        status:
          type: string
          enum: [initiated, verification_required, family_approval_pending]
          description: Reset initiation status
        verification_methods:
          type: array
          items:
            type: string
          description: Available verification methods
        family_verification_required:
          type: boolean
          description: Whether family verification is required
        estimated_completion_time:
          type: string
          description: Estimated time to complete reset process

    PasswordResetVerificationRequest:
      type: object
      required:
        - reset_session_id
        - verification_data
      properties:
        reset_session_id:
          type: string
          format: uuid
          description: Password reset session identifier
        verification_data:
          type: object
          description: Verification data (code, answers, etc.)
        verification_method:
          type: string
          description: Verification method used
        family_approval_data:
          type: object
          description: Family approval data if applicable

    PasswordResetVerificationResponse:
      type: object
      required:
        - verification_status
      properties:
        verification_status:
          type: string
          enum: [success, failed, partial, pending_family_approval]
          description: Verification status
        reset_token:
          type: string
          description: Password reset token (if verification successful)
        additional_verification_required:
          type: boolean
          description: Whether additional verification is required
        family_approval_status:
          type: object
          description: Family approval status

    PasswordResetCompletionRequest:
      type: object
      required:
        - reset_token
        - new_password
      properties:
        reset_token:
          type: string
          description: Password reset token
        new_password:
          type: string
          format: password
          description: New password
        password_confirmation:
          type: string
          format: password
          description: Password confirmation
        update_security_settings:
          type: boolean
          default: true
          description: Whether to update security settings
        revoke_all_sessions:
          type: boolean
          default: true
          description: Whether to revoke all existing sessions

    PasswordResetCompletionResponse:
      type: object
      required:
        - completion_status
      properties:
        completion_status:
          type: string
          enum: [success, failed, security_update_required]
          description: Reset completion status
        sessions_revoked:
          type: array
          items:
            type: string
          description: List of revoked session IDs
        security_settings_updated:
          type: boolean
          description: Whether security settings were updated
        family_notification_sent:
          type: boolean
          description: Whether family was notified of password change
        next_security_recommendations:
          type: array
          items:
            type: string
          description: Next security recommendations

    SecurityMonitoringResponse:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
          description: User identifier
        monitoring_period:
          type: object
          description: Monitoring time period information
        authentication_events:
          type: array
          items:
            type: object
          description: Authentication events and analysis
        session_security_metrics:
          type: object
          description: Session security metrics
        device_trust_analysis:
          type: object
          description: Device trust analysis
        family_security_coordination:
          type: object
          description: Family security coordination metrics
        threat_detection_results:
          type: object
          description: Threat detection analysis results
        memory_based_security_insights:
          type: object
          description: Memory-driven security insights
        security_recommendations:
          type: array
          items:
            type: string
          description: Personalized security recommendations
        risk_assessment:
          type: object
          description: Current security risk assessment

  responses:
    BadRequest:
      description: Bad request - invalid input parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Forbidden:
      description: Access forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    ConflictError:
      description: Conflict - resource already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          description: Additional error details
        trace_id:
          type: string
          description: Request trace identifier
