asyncapi: 3.0.0
info:
  title: Family AI - Policy Events
  version: 1.0.0
  description: |
    Memory-Centric Family AI Policy Enforcement Event Architecture

    This AsyncAPI specification defines policy enforcement events for
    RBAC/ABAC operations, consent management, privacy controls, family
    permission coordination, and security policy updates within the
    Memory-Centric Family AI platform.

    ## Policy Enforcement Overview

    ### Access Control Events
    - **RBAC Operations**: Role-based access control for family hierarchies
    - **ABAC Decisions**: Attribute-based access control with family context
    - **Permission Grants**: Dynamic permission assignment and inheritance
    - **Access Violations**: Security violation detection and response

    ### Consent and Privacy Management
    - **Consent Collection**: Family member consent gathering and verification
    - **Privacy Policy Updates**: Privacy policy changes and family notification
    - **Data Processing Consent**: Data processing consent for family operations
    - **Right Enforcement**: Data subject rights enforcement (GDPR, CCPA)

    ### Family Permission Coordination
    - **Family Approval Workflows**: Multi-member approval processes
    - **Guardian Permissions**: Parent/guardian permission management
    - **Age-Appropriate Controls**: Dynamic age-based permission adjustment
    - **Emergency Overrides**: Emergency access and permission escalation

    ## Event Architecture

    All policy events integrate with Memory-Centric Family AI:
    - `policy_context`: Family-aware policy enforcement context
    - `relationship_permissions`: Family relationship-based access control
    - `privacy_preservation`: Family privacy protection and data minimization
    - `consent_coordination`: Multi-member consent and approval workflows
    - `emergency_protocols`: Family emergency access and safety protocols

  contact:
    name: Family AI - Policy Enforcement Team
    email: policy@familyai.dev

servers:
  policy-backbone:
    host: policy-backbone.familyai.local
    protocol: kafka
    description: Policy Enforcement Event Bus
  consent-management:
    host: consent-management.familyai.local
    protocol: kafka
    description: Consent and Privacy Management Bus

channels:
  # Access Control Events
  policy/access/permission-granted:
    address: policy.access.permission_granted
    description: Permission granted events with family context
    messages:
      PermissionGranted:
        $ref: '#/components/messages/PermissionGranted'

  policy/access/permission-revoked:
    address: policy.access.permission_revoked
    description: Permission revocation with family coordination
    messages:
      PermissionRevoked:
        $ref: '#/components/messages/PermissionRevoked'

  policy/access/role-assigned:
    address: policy.access.role_assigned
    description: Family role assignment and inheritance
    messages:
      RoleAssigned:
        $ref: '#/components/messages/RoleAssigned'

  policy/access/violation-detected:
    address: policy.access.violation_detected
    description: Access violation detection and security alerts
    messages:
      AccessViolationDetected:
        $ref: '#/components/messages/AccessViolationDetected'

  policy/access/emergency-override:
    address: policy.access.emergency_override
    description: Emergency access override and safety protocols
    messages:
      EmergencyOverride:
        $ref: '#/components/messages/EmergencyOverride'

  # Consent Management Events
  policy/consent/request-initiated:
    address: policy.consent.request_initiated
    description: Consent request initiation for family operations
    messages:
      ConsentRequestInitiated:
        $ref: '#/components/messages/ConsentRequestInitiated'

  policy/consent/granted:
    address: policy.consent.granted
    description: Consent granted with family coordination
    messages:
      ConsentGranted:
        $ref: '#/components/messages/ConsentGranted'

  policy/consent/revoked:
    address: policy.consent.revoked
    description: Consent revocation and cleanup operations
    messages:
      ConsentRevoked:
        $ref: '#/components/messages/ConsentRevoked'

  policy/consent/expired:
    address: policy.consent.expired
    description: Consent expiration and renewal notifications
    messages:
      ConsentExpired:
        $ref: '#/components/messages/ConsentExpired'

  # Privacy Management Events
  policy/privacy/policy-updated:
    address: policy.privacy.policy_updated
    description: Privacy policy updates and family notification
    messages:
      PrivacyPolicyUpdated:
        $ref: '#/components/messages/PrivacyPolicyUpdated'

  policy/privacy/data-processing-request:
    address: policy.privacy.data_processing_request
    description: Data processing requests with family consent
    messages:
      DataProcessingRequest:
        $ref: '#/components/messages/DataProcessingRequest'

  policy/privacy/right-exercised:
    address: policy.privacy.right_exercised
    description: Data subject rights exercise (access, deletion, portability)
    messages:
      PrivacyRightExercised:
        $ref: '#/components/messages/PrivacyRightExercised'

  policy/privacy/breach-detected:
    address: policy.privacy.breach_detected
    description: Privacy breach detection and response coordination
    messages:
      PrivacyBreachDetected:
        $ref: '#/components/messages/PrivacyBreachDetected'

  # Family Coordination Events
  policy/family/approval-workflow-started:
    address: policy.family.approval_workflow_started
    description: Family approval workflow initiation
    messages:
      FamilyApprovalWorkflowStarted:
        $ref: '#/components/messages/FamilyApprovalWorkflowStarted'

  policy/family/approval-received:
    address: policy.family.approval_received
    description: Individual family member approval received
    messages:
      FamilyApprovalReceived:
        $ref: '#/components/messages/FamilyApprovalReceived'

  policy/family/guardian-permission-required:
    address: policy.family.guardian_permission_required
    description: Guardian permission requirement for child operations
    messages:
      GuardianPermissionRequired:
        $ref: '#/components/messages/GuardianPermissionRequired'

  policy/family/age-restriction-applied:
    address: policy.family.age_restriction_applied
    description: Age-appropriate restriction application
    messages:
      AgeRestrictionApplied:
        $ref: '#/components/messages/AgeRestrictionApplied'

  # Security Policy Events
  policy/security/policy-violation:
    address: policy.security.policy_violation
    description: Security policy violation detection
    messages:
      SecurityPolicyViolation:
        $ref: '#/components/messages/SecurityPolicyViolation'

  policy/security/threat-detected:
    address: policy.security.threat_detected
    description: Security threat detection and family protection
    messages:
      SecurityThreatDetected:
        $ref: '#/components/messages/SecurityThreatDetected'

  policy/security/quarantine-applied:
    address: policy.security.quarantine_applied
    description: Security quarantine and isolation measures
    messages:
      SecurityQuarantineApplied:
        $ref: '#/components/messages/SecurityQuarantineApplied'

  # Compliance Events
  policy/compliance/audit-initiated:
    address: policy.compliance.audit_initiated
    description: Compliance audit initiation for family operations
    messages:
      ComplianceAuditInitiated:
        $ref: '#/components/messages/ComplianceAuditInitiated'

  policy/compliance/violation-detected:
    address: policy.compliance.violation_detected
    description: Compliance violation detection and remediation
    messages:
      ComplianceViolationDetected:
        $ref: '#/components/messages/ComplianceViolationDetected'

operations:
  # Access Control Operations
  handlePermissionGrant:
    action: receive
    channel:
      $ref: '#/channels/policy~1access~1permission-granted'
    summary: Handle permission grants
    description: |
      Processes permission grants with family context and
      relationship-based access control inheritance.

  handleAccessViolation:
    action: receive
    channel:
      $ref: '#/channels/policy~1access~1violation-detected'
    summary: Handle access violations
    description: |
      Processes access violations with family coordination
      and security incident response.

  handleConsentRequest:
    action: receive
    channel:
      $ref: '#/channels/policy~1consent~1request-initiated'
    summary: Handle consent requests
    description: |
      Processes consent requests with family member
      coordination and approval workflows.

  publishFamilyApproval:
    action: send
    channel:
      $ref: '#/channels/policy~1family~1approval-workflow-started'
    summary: Publish family approval workflows
    description: |
      Publishes family approval workflows for multi-member
      decision making and coordination.

  handleSecurityEvents:
    action: receive
    channel:
      $ref: '#/channels/policy~1security~1threat-detected'
    summary: Handle security events
    description: |
      Processes security threats with family protection
      measures and emergency response coordination.

components:
  messages:
    PermissionGranted:
      name: PermissionGranted
      title: Permission Granted Event
      summary: Permission granted with family context
      contentType: application/json
      payload:
        $ref: '#/components/schemas/PermissionGrantedPayload'

    PermissionRevoked:
      name: PermissionRevoked
      title: Permission Revoked Event
      summary: Permission revocation with family coordination
      contentType: application/json
      payload:
        $ref: '#/components/schemas/PermissionRevokedPayload'

    RoleAssigned:
      name: RoleAssigned
      title: Role Assigned Event
      summary: Family role assignment and inheritance
      contentType: application/json
      payload:
        $ref: '#/components/schemas/RoleAssignedPayload'

    AccessViolationDetected:
      name: AccessViolationDetected
      title: Access Violation Detected Event
      summary: Access violation detection and security alerts
      contentType: application/json
      payload:
        $ref: '#/components/schemas/AccessViolationDetectedPayload'

    EmergencyOverride:
      name: EmergencyOverride
      title: Emergency Override Event
      summary: Emergency access override and safety protocols
      contentType: application/json
      payload:
        $ref: '#/components/schemas/EmergencyOverridePayload'

    ConsentRequestInitiated:
      name: ConsentRequestInitiated
      title: Consent Request Initiated Event
      summary: Consent request initiation for family operations
      contentType: application/json
      payload:
        $ref: '#/components/schemas/ConsentRequestInitiatedPayload'

    ConsentGranted:
      name: ConsentGranted
      title: Consent Granted Event
      summary: Consent granted with family coordination
      contentType: application/json
      payload:
        $ref: '#/components/schemas/ConsentGrantedPayload'

    ConsentRevoked:
      name: ConsentRevoked
      title: Consent Revoked Event
      summary: Consent revocation and cleanup operations
      contentType: application/json
      payload:
        $ref: '#/components/schemas/ConsentRevokedPayload'

    ConsentExpired:
      name: ConsentExpired
      title: Consent Expired Event
      summary: Consent expiration and renewal notifications
      contentType: application/json
      payload:
        $ref: '#/components/schemas/ConsentExpiredPayload'

    PrivacyPolicyUpdated:
      name: PrivacyPolicyUpdated
      title: Privacy Policy Updated Event
      summary: Privacy policy updates and family notification
      contentType: application/json
      payload:
        $ref: '#/components/schemas/PrivacyPolicyUpdatedPayload'

    DataProcessingRequest:
      name: DataProcessingRequest
      title: Data Processing Request Event
      summary: Data processing requests with family consent
      contentType: application/json
      payload:
        $ref: '#/components/schemas/DataProcessingRequestPayload'

    PrivacyRightExercised:
      name: PrivacyRightExercised
      title: Privacy Right Exercised Event
      summary: Data subject rights exercise (access, deletion, portability)
      contentType: application/json
      payload:
        $ref: '#/components/schemas/PrivacyRightExercisedPayload'

    PrivacyBreachDetected:
      name: PrivacyBreachDetected
      title: Privacy Breach Detected Event
      summary: Privacy breach detection and response coordination
      contentType: application/json
      payload:
        $ref: '#/components/schemas/PrivacyBreachDetectedPayload'

    FamilyApprovalWorkflowStarted:
      name: FamilyApprovalWorkflowStarted
      title: Family Approval Workflow Started Event
      summary: Family approval workflow initiation
      contentType: application/json
      payload:
        $ref: '#/components/schemas/FamilyApprovalWorkflowStartedPayload'

    FamilyApprovalReceived:
      name: FamilyApprovalReceived
      title: Family Approval Received Event
      summary: Individual family member approval received
      contentType: application/json
      payload:
        $ref: '#/components/schemas/FamilyApprovalReceivedPayload'

    GuardianPermissionRequired:
      name: GuardianPermissionRequired
      title: Guardian Permission Required Event
      summary: Guardian permission requirement for child operations
      contentType: application/json
      payload:
        $ref: '#/components/schemas/GuardianPermissionRequiredPayload'

    AgeRestrictionApplied:
      name: AgeRestrictionApplied
      title: Age Restriction Applied Event
      summary: Age-appropriate restriction application
      contentType: application/json
      payload:
        $ref: '#/components/schemas/AgeRestrictionAppliedPayload'

    SecurityPolicyViolation:
      name: SecurityPolicyViolation
      title: Security Policy Violation Event
      summary: Security policy violation detection
      contentType: application/json
      payload:
        $ref: '#/components/schemas/SecurityPolicyViolationPayload'

    SecurityThreatDetected:
      name: SecurityThreatDetected
      title: Security Threat Detected Event
      summary: Security threat detection and family protection
      contentType: application/json
      payload:
        $ref: '#/components/schemas/SecurityThreatDetectedPayload'

    SecurityQuarantineApplied:
      name: SecurityQuarantineApplied
      title: Security Quarantine Applied Event
      summary: Security quarantine and isolation measures
      contentType: application/json
      payload:
        $ref: '#/components/schemas/SecurityQuarantineAppliedPayload'

    ComplianceAuditInitiated:
      name: ComplianceAuditInitiated
      title: Compliance Audit Initiated Event
      summary: Compliance audit initiation for family operations
      contentType: application/json
      payload:
        $ref: '#/components/schemas/ComplianceAuditInitiatedPayload'

    ComplianceViolationDetected:
      name: ComplianceViolationDetected
      title: Compliance Violation Detected Event
      summary: Compliance violation detection and remediation
      contentType: application/json
      payload:
        $ref: '#/components/schemas/ComplianceViolationDetectedPayload'

  schemas:
    # Access Control Schemas
    PermissionGrantedPayload:
      type: object
      description: Permission granted with family context and inheritance
      required:
        - permission_id
        - subject_id
        - permission_details
        - family_context
        - grant_reason
      properties:
        permission_id:
          type: string
          format: uuid
        subject_id:
          type: string
          format: uuid
          description: Family member receiving permission
        permission_details:
          type: object
          description: Details of granted permission
          properties:
            permission_type:
              type: string
              enum: [resource_access, operation_permission, data_access, family_coordination, administrative]
            resource_identifier:
              type: string
            access_level:
              type: string
              enum: [read, write, admin, owner, full_control]
            scope:
              type: string
              enum: [personal, family_shared, extended_family, cross_family]
            duration:
              type: string
              enum: [permanent, temporary, session_based, conditional]
            expiration_date:
              type: string
              format: date-time
        family_context:
          type: object
          description: Family context for permission grant
          properties:
            granted_by:
              type: string
              format: uuid
            family_role_based:
              type: boolean
            relationship_inheritance:
              type: boolean
            requires_family_approval:
              type: boolean
            guardian_approval_obtained:
              type: boolean
        grant_reason:
          type: string
          enum: [role_based, explicit_grant, inheritance, emergency, family_decision, age_progression]

    PermissionRevokedPayload:
      type: object
      description: Permission revocation with family impact assessment
      required:
        - permission_id
        - subject_id
        - revocation_details
        - family_impact
        - cleanup_actions
      properties:
        permission_id:
          type: string
          format: uuid
        subject_id:
          type: string
          format: uuid
        revocation_details:
          type: object
          description: Details of permission revocation
          properties:
            revoked_by:
              type: string
              format: uuid
            revocation_reason:
              type: string
              enum: [policy_violation, role_change, family_decision, security_incident, age_restriction, emergency_response]
            revocation_scope:
              type: string
              enum: [single_permission, permission_group, all_permissions, family_wide]
            immediate_effect:
              type: boolean
        family_impact:
          type: object
          description: Impact of revocation on family
          properties:
            affects_family_coordination:
              type: boolean
            requires_family_notification:
              type: boolean
            alternative_permissions_needed:
              type: boolean
            dependent_permissions_affected:
              type: array
              items:
                type: string
        cleanup_actions:
          type: object
          description: Cleanup actions for permission revocation
          properties:
            active_sessions_terminated:
              type: boolean
            cached_permissions_cleared:
              type: boolean
            family_members_notified:
              type: boolean
            audit_trail_created:
              type: boolean

    RoleAssignedPayload:
      type: object
      description: Family role assignment with inheritance patterns
      required:
        - role_assignment_id
        - subject_id
        - role_details
        - family_hierarchy
        - permission_inheritance
      properties:
        role_assignment_id:
          type: string
          format: uuid
        subject_id:
          type: string
          format: uuid
        role_details:
          type: object
          description: Details of assigned role
          properties:
            role_name:
              type: string
              enum: [family_admin, parent, guardian, child, teenager, extended_family, guest, caregiver, temporary_guardian]
            role_scope:
              type: string
              enum: [global, family_specific, resource_specific, time_limited]
            role_priority:
              type: integer
              minimum: 1
              maximum: 10
            role_capabilities:
              type: array
              items:
                type: string
        family_hierarchy:
          type: object
          description: Family hierarchy and relationship context
          properties:
            assigned_by:
              type: string
              format: uuid
            assignment_method:
              type: string
              enum: [automatic, manual, inherited, temporary_delegation]
            relationship_based:
              type: boolean
            affects_relationships:
              type: array
              items:
                type: string
                format: uuid
        permission_inheritance:
          type: object
          description: Permission inheritance from role
          properties:
            inherited_permissions:
              type: array
              items:
                type: string
            delegated_permissions:
              type: array
              items:
                type: string
            restricted_permissions:
              type: array
              items:
                type: string
            conditional_permissions:
              type: array
              items:
                type: object
                properties:
                  permission:
                    type: string
                  condition:
                    type: string

    AccessViolationDetectedPayload:
      type: object
      description: Access violation detection with security assessment
      required:
        - violation_id
        - subject_id
        - violation_details
        - security_assessment
        - response_actions
      properties:
        violation_id:
          type: string
          format: uuid
        subject_id:
          type: string
          format: uuid
        violation_details:
          type: object
          description: Details of access violation
          properties:
            violation_type:
              type: string
              enum: [unauthorized_access, privilege_escalation, resource_abuse, policy_bypass, family_boundary_breach]
            attempted_action:
              type: string
            target_resource:
              type: string
            violation_time:
              type: string
              format: date-time
            violation_source:
              type: object
              properties:
                device_id:
                  type: string
                ip_address:
                  type: string
                user_agent:
                  type: string
                location_context:
                  type: string
        security_assessment:
          type: object
          description: Security assessment of violation
          properties:
            severity_level:
              type: string
              enum: [low, medium, high, critical, emergency]
            threat_classification:
              type: string
              enum: [accidental, intentional, malicious, system_error, family_boundary_confusion]
            family_safety_impact:
              type: string
              enum: [none, low, medium, high, critical]
            escalation_required:
              type: boolean
        response_actions:
          type: object
          description: Response actions taken
          properties:
            immediate_actions:
              type: array
              items:
                type: string
            family_notification_sent:
              type: boolean
            access_temporarily_suspended:
              type: boolean
            security_team_notified:
              type: boolean
            additional_monitoring_enabled:
              type: boolean

    EmergencyOverridePayload:
      type: object
      description: Emergency access override with safety protocols
      required:
        - override_id
        - emergency_context
        - override_details
        - safety_protocols
        - family_coordination
      properties:
        override_id:
          type: string
          format: uuid
        emergency_context:
          type: object
          description: Context and justification for emergency override
          properties:
            emergency_type:
              type: string
              enum: [medical_emergency, safety_threat, family_crisis, technical_emergency, natural_disaster]
            severity_level:
              type: string
              enum: [low, medium, high, critical, life_threatening]
            initiating_party:
              type: string
              format: uuid
            emergency_verification:
              type: object
              properties:
                verification_method:
                  type: string
                  enum: [biometric, emergency_code, family_confirmation, system_detection]
                verification_confidence:
                  type: number
                  minimum: 0
                  maximum: 1
        override_details:
          type: object
          description: Details of emergency override
          properties:
            overridden_policies:
              type: array
              items:
                type: string
            granted_emergency_permissions:
              type: array
              items:
                type: string
            access_scope:
              type: string
              enum: [limited, extended, full, system_wide]
            duration_limit:
              type: string
              format: duration
            automatic_expiration:
              type: boolean
        safety_protocols:
          type: object
          description: Safety protocols during emergency override
          properties:
            enhanced_monitoring:
              type: boolean
            family_notification_required:
              type: boolean
            emergency_contacts_alerted:
              type: boolean
            audit_trail_enhanced:
              type: boolean
            automatic_review_scheduled:
              type: boolean
        family_coordination:
          type: object
          description: Family coordination during emergency
          properties:
            family_members_notified:
              type: array
              items:
                type: string
                format: uuid
            coordination_channel_activated:
              type: boolean
            family_rally_point_established:
              type: boolean
            emergency_procedures_initiated:
              type: boolean

    # Consent Management Schemas
    ConsentRequestInitiatedPayload:
      type: object
      description: Consent request with family coordination requirements
      required:
        - consent_request_id
        - requesting_party
        - consent_details
        - family_coordination
        - legal_basis
      properties:
        consent_request_id:
          type: string
          format: uuid
        requesting_party:
          type: string
          format: uuid
        consent_details:
          type: object
          description: Details of consent request
          properties:
            consent_type:
              type: string
              enum: [data_processing, feature_access, external_sharing, family_coordination, medical_data, location_sharing]
            purpose_description:
              type: string
            data_categories:
              type: array
              items:
                type: string
                enum: [personal_data, family_data, interaction_data, device_data, location_data, biometric_data]
            processing_duration:
              type: string
              enum: [one_time, ongoing, time_limited, indefinite]
            third_party_sharing:
              type: boolean
        family_coordination:
          type: object
          description: Family coordination requirements
          properties:
            requires_family_consent:
              type: boolean
            guardian_consent_required:
              type: boolean
            age_appropriate_controls:
              type: boolean
            family_members_involved:
              type: array
              items:
                type: string
                format: uuid
        legal_basis:
          type: string
          enum: [consent, legitimate_interest, contract, legal_obligation, vital_interests, public_task]

    ConsentGrantedPayload:
      type: object
      description: Consent granted with family coordination tracking
      required:
        - consent_request_id
        - granting_party
        - consent_scope
        - family_coordination_status
        - consent_conditions
      properties:
        consent_request_id:
          type: string
          format: uuid
        granting_party:
          type: string
          format: uuid
        consent_scope:
          type: object
          description: Scope of granted consent
          properties:
            granted_purposes:
              type: array
              items:
                type: string
            data_categories_approved:
              type: array
              items:
                type: string
            processing_limitations:
              type: array
              items:
                type: string
            expiration_date:
              type: string
              format: date-time
        family_coordination_status:
          type: object
          description: Family coordination status
          properties:
            all_required_consents_obtained:
              type: boolean
            guardian_approval_status:
              type: string
              enum: [not_required, pending, obtained, denied]
            family_consensus_achieved:
              type: boolean
            age_verification_completed:
              type: boolean
        consent_conditions:
          type: object
          description: Conditions and restrictions on consent
          properties:
            revocation_method:
              type: string
            notification_requirements:
              type: array
              items:
                type: string
            data_subject_rights:
              type: array
              items:
                type: string
            family_oversight_required:
              type: boolean

    ConsentRevokedPayload:
      type: object
      description: Consent revocation with cleanup coordination
      required:
        - consent_request_id
        - revoking_party
        - revocation_details
        - cleanup_requirements
        - family_impact
      properties:
        consent_request_id:
          type: string
          format: uuid
        revoking_party:
          type: string
          format: uuid
        revocation_details:
          type: object
          description: Details of consent revocation
          properties:
            revocation_reason:
              type: string
              enum: [user_request, family_decision, policy_change, safety_concern, legal_requirement]
            revocation_scope:
              type: string
              enum: [full_revocation, partial_revocation, temporary_suspension]
            effective_date:
              type: string
              format: date-time
            grace_period:
              type: string
              format: duration
        cleanup_requirements:
          type: object
          description: Data cleanup requirements
          properties:
            data_deletion_required:
              type: boolean
            processing_cessation_required:
              type: boolean
            third_party_notification_required:
              type: boolean
            family_data_disentanglement:
              type: boolean
        family_impact:
          type: object
          description: Impact on family operations
          properties:
            affects_family_features:
              type: boolean
            requires_family_notification:
              type: boolean
            alternative_consent_needed:
              type: boolean
            family_coordination_impact:
              type: string
              enum: [none, minimal, moderate, significant, severe]

    ConsentExpiredPayload:
      type: object
      description: Consent expiration with renewal coordination
      required:
        - consent_request_id
        - expiration_details
        - renewal_options
        - family_coordination
        - automatic_cleanup
      properties:
        consent_request_id:
          type: string
          format: uuid
        expiration_details:
          type: object
          description: Details of consent expiration
          properties:
            expiration_date:
              type: string
              format: date-time
            expiration_reason:
              type: string
              enum: [time_limit_reached, purpose_fulfilled, policy_change, family_change]
            grace_period_available:
              type: boolean
            grace_period_duration:
              type: string
              format: duration
        renewal_options:
          type: object
          description: Options for consent renewal
          properties:
            automatic_renewal_possible:
              type: boolean
            family_renewal_required:
              type: boolean
            updated_consent_needed:
              type: boolean
            renewal_deadline:
              type: string
              format: date-time
        family_coordination:
          type: object
          description: Family coordination for renewal
          properties:
            family_notification_sent:
              type: boolean
            guardian_renewal_required:
              type: boolean
            family_decision_needed:
              type: boolean
            coordination_deadline:
              type: string
              format: date-time
        automatic_cleanup:
          type: object
          description: Automatic cleanup actions
          properties:
            data_processing_suspended:
              type: boolean
            access_permissions_revoked:
              type: boolean
            family_features_disabled:
              type: boolean
            cleanup_completion_date:
              type: string
              format: date-time

    # Privacy Management Schemas
    PrivacyPolicyUpdatedPayload:
      type: object
      description: Privacy policy updates with family notification
      required:
        - policy_update_id
        - policy_changes
        - family_impact_assessment
        - notification_requirements
        - compliance_updates
      properties:
        policy_update_id:
          type: string
          format: uuid
        policy_changes:
          type: object
          description: Details of privacy policy changes
          properties:
            policy_version:
              type: string
            change_type:
              type: string
              enum: [minor_update, major_revision, new_policy, policy_consolidation]
            changed_sections:
              type: array
              items:
                type: object
                properties:
                  section_name:
                    type: string
                  change_description:
                    type: string
                  impact_level:
                    type: string
                    enum: [low, medium, high]
            effective_date:
              type: string
              format: date-time
        family_impact_assessment:
          type: object
          description: Assessment of policy impact on families
          properties:
            requires_new_consent:
              type: boolean
            affects_family_features:
              type: boolean
            changes_data_processing:
              type: boolean
            impacts_children:
              type: boolean
            requires_guardian_review:
              type: boolean
        notification_requirements:
          type: object
          description: Family notification requirements
          properties:
            notification_method:
              type: array
              items:
                type: string
                enum: [in_app, email, sms, postal_mail]
            notification_deadline:
              type: string
              format: date-time
            acknowledgment_required:
              type: boolean
            family_discussion_recommended:
              type: boolean
        compliance_updates:
          type: object
          description: Regulatory compliance updates
          properties:
            regulatory_drivers:
              type: array
              items:
                type: string
                enum: [gdpr, ccpa, coppa, local_privacy_law]
            compliance_deadline:
              type: string
              format: date-time
            new_rights_granted:
              type: array
              items:
                type: string
            family_protections_enhanced:
              type: boolean

    DataProcessingRequestPayload:
      type: object
      description: Data processing request with family consent coordination
      required:
        - processing_request_id
        - processing_details
        - family_data_involved
        - consent_requirements
        - privacy_safeguards
      properties:
        processing_request_id:
          type: string
          format: uuid
        processing_details:
          type: object
          description: Details of data processing request
          properties:
            processing_purpose:
              type: string
            data_categories:
              type: array
              items:
                type: string
            processing_method:
              type: string
              enum: [automated, manual, ai_assisted, third_party]
            processing_duration:
              type: string
              format: duration
            output_data_types:
              type: array
              items:
                type: string
        family_data_involved:
          type: object
          description: Family data involvement assessment
          properties:
            individual_data_only:
              type: boolean
            family_shared_data:
              type: boolean
            children_data_included:
              type: boolean
            relationship_data_included:
              type: boolean
            cross_family_data:
              type: boolean
        consent_requirements:
          type: object
          description: Consent requirements for processing
          properties:
            explicit_consent_required:
              type: boolean
            guardian_consent_needed:
              type: boolean
            family_consensus_required:
              type: boolean
            consent_deadline:
              type: string
              format: date-time
        privacy_safeguards:
          type: object
          description: Privacy safeguards for processing
          properties:
            data_minimization_applied:
              type: boolean
            anonymization_techniques:
              type: array
              items:
                type: string
            access_controls_enhanced:
              type: boolean
            audit_trail_maintained:
              type: boolean

    PrivacyRightExercisedPayload:
      type: object
      description: Privacy rights exercise with family coordination
      required:
        - right_exercise_id
        - requesting_party
        - right_details
        - family_implications
        - fulfillment_plan
      properties:
        right_exercise_id:
          type: string
          format: uuid
        requesting_party:
          type: string
          format: uuid
        right_details:
          type: object
          description: Details of privacy right exercise
          properties:
            right_type:
              type: string
              enum: [access, rectification, erasure, portability, restriction, objection, withdrawal_consent]
            scope_of_request:
              type: string
              enum: [personal_data_only, family_shared_data, all_data, specific_categories]
            specific_data_categories:
              type: array
              items:
                type: string
            request_justification:
              type: string
        family_implications:
          type: object
          description: Implications for family operations
          properties:
            affects_other_family_members:
              type: boolean
            requires_family_consultation:
              type: boolean
            impacts_family_features:
              type: boolean
            needs_guardian_approval:
              type: boolean
            conflicts_with_family_consent:
              type: boolean
        fulfillment_plan:
          type: object
          description: Plan for fulfilling privacy right
          properties:
            fulfillment_method:
              type: string
            estimated_completion_time:
              type: string
              format: duration
            family_coordination_required:
              type: boolean
            technical_challenges:
              type: array
              items:
                type: string
            compliance_deadline:
              type: string
              format: date-time

    PrivacyBreachDetectedPayload:
      type: object
      description: Privacy breach detection with family protection measures
      required:
        - breach_id
        - breach_details
        - family_impact_assessment
        - response_plan
        - notification_requirements
      properties:
        breach_id:
          type: string
          format: uuid
        breach_details:
          type: object
          description: Details of privacy breach
          properties:
            breach_type:
              type: string
              enum: [unauthorized_access, data_leak, system_compromise, human_error, third_party_breach]
            affected_data_types:
              type: array
              items:
                type: string
            breach_source:
              type: string
              enum: [internal_system, external_attack, human_error, third_party, unknown]
            detection_method:
              type: string
              enum: [automated_monitoring, user_report, third_party_notification, audit_discovery]
            breach_timeline:
              type: object
              properties:
                incident_start:
                  type: string
                  format: date-time
                detection_time:
                  type: string
                  format: date-time
                containment_time:
                  type: string
                  format: date-time
        family_impact_assessment:
          type: object
          description: Assessment of breach impact on families
          properties:
            families_affected:
              type: integer
              minimum: 0
            children_data_compromised:
              type: boolean
            sensitive_family_data_exposed:
              type: boolean
            relationship_data_compromised:
              type: boolean
            potential_harm_level:
              type: string
              enum: [low, medium, high, severe]
        response_plan:
          type: object
          description: Breach response plan
          properties:
            immediate_containment_actions:
              type: array
              items:
                type: string
            family_protection_measures:
              type: array
              items:
                type: string
            investigation_initiated:
              type: boolean
            law_enforcement_contacted:
              type: boolean
            regulatory_notification_required:
              type: boolean
        notification_requirements:
          type: object
          description: Family notification requirements
          properties:
            notification_deadline:
              type: string
              format: date-time
            notification_method:
              type: array
              items:
                type: string
            content_customization_required:
              type: boolean
            support_resources_provided:
              type: boolean
            follow_up_communication_planned:
              type: boolean

    # Additional schemas for remaining message types (simplified for brevity)
    FamilyApprovalWorkflowStartedPayload:
      type: object
      required:
        - workflow_id
        - approval_request
        - participating_members
        - approval_criteria
        - deadline
      properties:
        workflow_id:
          type: string
          format: uuid
        approval_request:
          type: object
        participating_members:
          type: array
          items:
            type: string
            format: uuid
        approval_criteria:
          type: object
        deadline:
          type: string
          format: date-time

    FamilyApprovalReceivedPayload:
      type: object
      required:
        - workflow_id
        - approving_member
        - approval_decision
        - decision_context
        - workflow_status
      properties:
        workflow_id:
          type: string
          format: uuid
        approving_member:
          type: string
          format: uuid
        approval_decision:
          type: string
          enum: [approved, denied, conditional, deferred]
        decision_context:
          type: object
        workflow_status:
          type: string
          enum: [pending, completed, failed, expired]

    GuardianPermissionRequiredPayload:
      type: object
      required:
        - permission_request_id
        - child_member_id
        - guardian_member_id
        - permission_details
        - urgency_level
      properties:
        permission_request_id:
          type: string
          format: uuid
        child_member_id:
          type: string
          format: uuid
        guardian_member_id:
          type: string
          format: uuid
        permission_details:
          type: object
        urgency_level:
          type: string
          enum: [low, normal, high, urgent]

    AgeRestrictionAppliedPayload:
      type: object
      required:
        - restriction_id
        - family_member_id
        - restriction_details
        - age_context
        - enforcement_actions
      properties:
        restriction_id:
          type: string
          format: uuid
        family_member_id:
          type: string
          format: uuid
        restriction_details:
          type: object
        age_context:
          type: object
        enforcement_actions:
          type: array
          items:
            type: string

    SecurityPolicyViolationPayload:
      type: object
      required:
        - violation_id
        - policy_violated
        - violation_details
        - severity_assessment
        - enforcement_actions
      properties:
        violation_id:
          type: string
          format: uuid
        policy_violated:
          type: string
        violation_details:
          type: object
        severity_assessment:
          type: object
        enforcement_actions:
          type: array
          items:
            type: string

    SecurityThreatDetectedPayload:
      type: object
      required:
        - threat_id
        - threat_type
        - threat_details
        - family_protection_measures
        - response_coordination
      properties:
        threat_id:
          type: string
          format: uuid
        threat_type:
          type: string
          enum: [malware, phishing, unauthorized_access, data_breach, social_engineering]
        threat_details:
          type: object
        family_protection_measures:
          type: object
        response_coordination:
          type: object

    SecurityQuarantineAppliedPayload:
      type: object
      required:
        - quarantine_id
        - target_entity
        - quarantine_reason
        - isolation_measures
        - family_coordination
      properties:
        quarantine_id:
          type: string
          format: uuid
        target_entity:
          type: string
        quarantine_reason:
          type: string
        isolation_measures:
          type: object
        family_coordination:
          type: object

    ComplianceAuditInitiatedPayload:
      type: object
      required:
        - audit_id
        - audit_scope
        - compliance_framework
        - family_involvement
        - audit_timeline
      properties:
        audit_id:
          type: string
          format: uuid
        audit_scope:
          type: object
        compliance_framework:
          type: array
          items:
            type: string
        family_involvement:
          type: object
        audit_timeline:
          type: object

    ComplianceViolationDetectedPayload:
      type: object
      required:
        - violation_id
        - compliance_requirement
        - violation_details
        - family_impact
        - remediation_plan
      properties:
        violation_id:
          type: string
          format: uuid
        compliance_requirement:
          type: string
        violation_details:
          type: object
        family_impact:
          type: object
        remediation_plan:
          type: object
