{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://memoryos.local/contracts/globals/storage/common.schema.json",
  "title": "MemoryOS Common Schema Definitions",
  "description": "Shared schema components used across all MemoryOS modules",

  "$defs": {
    "ULID": {
      "type": "string",
      "pattern": "^[0-7][0-9A-HJKMNP-TV-Z]{25}$",
      "description": "Universally Unique Lexicographically Sortable Identifier"
    },

    "UUID": {
      "type": "string",
      "format": "uuid",
      "description": "Standard UUID v4"
    },

    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp with timezone"
    },

    "unix_timestamp": {
      "type": "integer",
      "minimum": 0,
      "description": "Unix timestamp in seconds"
    },

    "space_id": {
      "$ref": "#/$defs/ULID",
      "description": "Memory space identifier"
    },

    "user_id": {
      "$ref": "#/$defs/ULID",
      "description": "User identifier"
    },

    "memory_id": {
      "$ref": "#/$defs/ULID",
      "description": "Memory item identifier"
    },

    "security_context": {
      "type": "object",
      "required": ["user_id", "roles", "capabilities"],
      "properties": {
        "user_id": { "$ref": "#/$defs/user_id" },
        "space_id": { "$ref": "#/$defs/space_id" },
        "roles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "capabilities": {
          "type": "array",
          "items": { "type": "string" }
        },
        "trust_level": {
          "type": "string",
          "enum": ["unverified", "basic", "verified", "high"]
        },
        "security_band": {
          "type": "string",
          "enum": ["public", "internal", "confidential", "restricted"]
        }
      }
    },

    "pagination": {
      "type": "object",
      "properties": {
        "limit": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1000,
          "default": 50
        },
        "offset": {
          "type": "integer",
          "minimum": 0,
          "default": 0
        },
        "cursor": {
          "type": "string",
          "description": "Opaque pagination cursor"
        }
      }
    },

    "error_response": {
      "type": "object",
      "required": ["error", "message"],
      "properties": {
        "error": {
          "type": "string",
          "description": "Error code"
        },
        "message": {
          "type": "string",
          "description": "Human-readable error message"
        },
        "details": {
          "type": "object",
          "description": "Additional error context"
        },
        "trace_id": {
          "type": "string",
          "description": "Request trace identifier"
        }
      }
    }
  }
}
