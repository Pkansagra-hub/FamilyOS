openapi: 3.1.0
info:
  title: MemoryOS App Plane - Workspaces API
  description: |
    **Memory-Centric Family AI Workspace Management**

    This API manages family-aware collaborative workspaces that integrate with the Memory-Centric Family AI system:
    - **Family Workspaces**: Shared spaces for family collaboration with memory-driven context
    - **Memory-Integrated Projects**: Workspaces that leverage family memory for enhanced collaboration
    - **Cross-Device Workspace Sync**: Seamless workspace access across family devices with E2EE
    - **Relationship-Aware Permissions**: Workspace access based on family roles and relationships
    - **Intelligence-Enhanced Collaboration**: AI-powered workspace features using family context

    **Memory-Centric Design**: All workspaces integrate with the Memory Backbone to:
    - Preserve workspace context and collaboration history in family memory
    - Provide intelligent suggestions based on family patterns and preferences
    - Enable memory-triggered workspace notifications and coordination
    - Support cross-device workspace handoff with memory context preservation

    **Architecture Integration**:
    - Leverages Memory Backbone for workspace context and collaboration intelligence
    - Integrates with Family Intelligence for relationship-appropriate workspace access
    - Coordinates with Device Ecosystem for seamless cross-device workspace experience
    - Enforces family policies through Policy Engine integration
  version: "1.0.0"
  contact:
    name: MemoryOS API Team
    url: https://familyos.local/support
    email: api-support@familyos.local
  license:
    name: Family OS Private License
    url: https://familyos.local/licenses/family-os

servers:
  - url: https://api.familyos.local/app/v1
    description: Production App Plane
  - url: https://staging-api.familyos.local/app/v1
    description: Staging Environment
  - url: http://localhost:8080/app/v1
    description: Local Development

security:
  - FamilyOSAuth: []
  - DeviceAuth: []

paths:
  /workspaces:
    get:
      summary: List Family Workspaces
      description: |
        Retrieve workspaces accessible to the authenticated user with family context and memory integration.

        **Memory Integration**: Returns workspaces with memory-driven context and collaboration history.
        **Family Intelligence**: Filters workspaces based on family hierarchy and relationship appropriateness.
      operationId: listWorkspaces
      parameters:
        - name: workspace_type
          in: query
          description: Filter workspaces by type
          required: false
          schema:
            type: string
            enum: [family, personal, shared, project, emergency]
        - name: access_level
          in: query
          description: Filter by user's access level
          required: false
          schema:
            type: string
            enum: [owner, admin, editor, viewer, guest]
        - name: family_context
          in: query
          description: Include family context in workspace data
          required: false
          schema:
            type: boolean
            default: true
        - name: include_archived
          in: query
          description: Include archived workspaces
          required: false
          schema:
            type: boolean
            default: false
        - name: memory_enhanced
          in: query
          description: Include memory-enhanced workspace features
          required: false
          schema:
            type: boolean
            default: true
        - name: limit
          in: query
          description: Maximum number of workspaces to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Pagination offset
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Workspaces retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspaces:
                    type: array
                    items:
                      $ref: '#/components/schemas/FamilyWorkspace'
                  total_count:
                    type: integer
                  family_summary:
                    $ref: '#/components/schemas/WorkspaceFamilySummary'
                  memory_context:
                    $ref: '#/components/schemas/WorkspaceMemoryContext'
                  collaboration_insights:
                    $ref: '#/components/schemas/CollaborationInsights'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Management

    post:
      summary: Create Family Workspace
      description: |
        Create a new family workspace with memory integration and relationship-aware permissions.

        **Memory Integration**: Creates workspace context in family memory for intelligence features.
        **Family Intelligence**: Configures workspace with family-appropriate access and collaboration rules.
      operationId: createWorkspace
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorkspaceRequest'
      responses:
        '201':
          description: Workspace created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspace:
                    $ref: '#/components/schemas/FamilyWorkspace'
                  family_setup:
                    $ref: '#/components/schemas/WorkspaceFamilySetup'
                  memory_integration:
                    $ref: '#/components/schemas/WorkspaceMemoryIntegration'
                  collaboration_features:
                    $ref: '#/components/schemas/CollaborationFeatures'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Management

  /workspaces/{workspace_id}:
    get:
      summary: Get Workspace Details
      description: |
        Retrieve detailed information about a workspace including family context and memory integration.

        **Memory Integration**: Returns workspace with full memory context and collaboration intelligence.
        **Family Intelligence**: Provides relationship-aware workspace details and access information.
      operationId: getWorkspaceDetails
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
        - name: include_family_context
          in: query
          description: Include detailed family context
          required: false
          schema:
            type: boolean
            default: true
        - name: include_memory_insights
          in: query
          description: Include memory-driven insights
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Workspace details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspace:
                    $ref: '#/components/schemas/FamilyWorkspaceDetailed'
                  family_context:
                    $ref: '#/components/schemas/WorkspaceFamilyContext'
                  memory_insights:
                    $ref: '#/components/schemas/WorkspaceMemoryInsights'
                  collaboration_status:
                    $ref: '#/components/schemas/CollaborationStatus'
                  access_permissions:
                    $ref: '#/components/schemas/WorkspaceAccessPermissions'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Management

    put:
      summary: Update Workspace
      description: |
        Update workspace configuration with family coordination and memory context preservation.

        **Memory Integration**: Updates workspace context in family memory and maintains collaboration history.
        **Family Intelligence**: Coordinates updates across family members with appropriate notifications.
      operationId: updateWorkspace
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWorkspaceRequest'
      responses:
        '200':
          description: Workspace updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspace:
                    $ref: '#/components/schemas/FamilyWorkspace'
                  family_coordination_updates:
                    type: array
                    items:
                      type: string
                      format: uuid
                  memory_context_updated:
                    type: boolean
                  collaboration_impact:
                    $ref: '#/components/schemas/CollaborationImpact'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Management

    delete:
      summary: Delete Workspace
      description: |
        Delete a workspace while preserving family collaboration context in memory.

        **Memory Integration**: Archives workspace context in family memory for historical reference.
        **Family Intelligence**: Coordinates deletion across family members with appropriate preservation.
      operationId: deleteWorkspace
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
        - name: preserve_family_context
          in: query
          description: Whether to preserve family collaboration context
          required: false
          schema:
            type: boolean
            default: true
        - name: archive_content
          in: query
          description: Whether to archive workspace content in memory
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Workspace deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspace_id:
                    type: string
                    format: uuid
                  family_context_preserved:
                    type: boolean
                  content_archived:
                    type: boolean
                  coordination_updates:
                    type: array
                    items:
                      type: string
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Management

  /workspaces/{workspace_id}/members:
    get:
      summary: List Workspace Members
      description: |
        Retrieve workspace members with family relationship context and collaboration insights.

        **Family Intelligence**: Returns members with family relationship data and collaboration patterns.
        **Memory Integration**: Provides memory-driven insights about member collaboration and preferences.
      operationId: listWorkspaceMembers
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
        - name: include_family_context
          in: query
          description: Include family relationship context
          required: false
          schema:
            type: boolean
            default: true
        - name: include_collaboration_insights
          in: query
          description: Include collaboration pattern insights
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Workspace members retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  members:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkspaceMember'
                  family_relationships:
                    $ref: '#/components/schemas/WorkspaceFamilyRelationships'
                  collaboration_patterns:
                    $ref: '#/components/schemas/CollaborationPatterns'
                  member_insights:
                    $ref: '#/components/schemas/MemberCollaborationInsights'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Members

    post:
      summary: Add Workspace Member
      description: |
        Add a family member to the workspace with relationship-appropriate permissions and memory context.

        **Family Intelligence**: Configures member access based on family relationships and workspace appropriateness.
        **Memory Integration**: Establishes member context in workspace memory for collaboration intelligence.
      operationId: addWorkspaceMember
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddWorkspaceMemberRequest'
      responses:
        '201':
          description: Workspace member added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  member:
                    $ref: '#/components/schemas/WorkspaceMember'
                  family_relationship_context:
                    $ref: '#/components/schemas/FamilyRelationshipContext'
                  permission_rationale:
                    $ref: '#/components/schemas/PermissionRationale'
                  collaboration_setup:
                    $ref: '#/components/schemas/CollaborationSetup'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          description: Member already exists in workspace
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Members

  /workspaces/{workspace_id}/members/{user_id}:
    get:
      summary: Get Workspace Member Details
      description: |
        Retrieve detailed information about a workspace member including family context and collaboration data.

        **Family Intelligence**: Returns member data with family relationship context and role appropriateness.
        **Memory Integration**: Provides collaboration history and pattern insights from family memory.
      operationId: getWorkspaceMemberDetails
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
        - name: user_id
          in: path
          description: User identifier
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Workspace member details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  member:
                    $ref: '#/components/schemas/WorkspaceMemberDetailed'
                  family_relationship:
                    $ref: '#/components/schemas/FamilyRelationshipDetails'
                  collaboration_history:
                    $ref: '#/components/schemas/CollaborationHistory'
                  activity_patterns:
                    $ref: '#/components/schemas/ActivityPatterns'
                  permissions_analysis:
                    $ref: '#/components/schemas/PermissionsAnalysis'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Members

    put:
      summary: Update Workspace Member
      description: |
        Update workspace member permissions and configuration with family relationship validation.

        **Family Intelligence**: Validates permission changes against family policies and relationships.
        **Memory Integration**: Updates member context in workspace memory and coordination records.
      operationId: updateWorkspaceMember
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
        - name: user_id
          in: path
          description: User identifier
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWorkspaceMemberRequest'
      responses:
        '200':
          description: Workspace member updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  member:
                    $ref: '#/components/schemas/WorkspaceMember'
                  permission_changes:
                    type: array
                    items:
                      type: string
                  family_policy_validation:
                    $ref: '#/components/schemas/FamilyPolicyValidation'
                  collaboration_impact:
                    $ref: '#/components/schemas/CollaborationImpact'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Members

    delete:
      summary: Remove Workspace Member
      description: |
        Remove a member from the workspace while preserving family collaboration context.

        **Family Intelligence**: Handles member removal with family relationship consideration and coordination.
        **Memory Integration**: Archives member collaboration context while removing access.
      operationId: removeWorkspaceMember
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
        - name: user_id
          in: path
          description: User identifier
          required: true
          schema:
            type: string
            format: uuid
        - name: preserve_collaboration_history
          in: query
          description: Whether to preserve collaboration history in memory
          required: false
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Workspace member removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user_id:
                    type: string
                    format: uuid
                  collaboration_history_preserved:
                    type: boolean
                  family_coordination_updates:
                    type: array
                    items:
                      type: string
                  access_transition_plan:
                    $ref: '#/components/schemas/AccessTransitionPlan'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Members

  /workspaces/{workspace_id}/content:
    get:
      summary: List Workspace Content
      description: |
        Retrieve workspace content with memory-driven organization and family-appropriate filtering.

        **Memory Integration**: Returns content with memory context and intelligent organization.
        **Family Intelligence**: Filters content based on family member access rights and age appropriateness.
      operationId: listWorkspaceContent
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
        - name: content_type
          in: query
          description: Filter by content type
          required: false
          schema:
            type: string
            enum: [document, image, video, audio, note, task, event, memory]
        - name: family_appropriate
          in: query
          description: Filter for family-appropriate content only
          required: false
          schema:
            type: boolean
            default: true
        - name: memory_enhanced
          in: query
          description: Include memory-driven content insights
          required: false
          schema:
            type: boolean
            default: true
        - name: sort_by
          in: query
          description: Sort content by criteria
          required: false
          schema:
            type: string
            enum: [created_at, modified_at, relevance, family_importance, memory_strength]
            default: modified_at
        - name: limit
          in: query
          description: Maximum number of content items to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        '200':
          description: Workspace content retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkspaceContent'
                  organization_insights:
                    $ref: '#/components/schemas/ContentOrganizationInsights'
                  family_relevance:
                    $ref: '#/components/schemas/FamilyContentRelevance'
                  memory_connections:
                    $ref: '#/components/schemas/MemoryContentConnections'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Content

    post:
      summary: Create Workspace Content
      description: |
        Create new content in the workspace with memory integration and family context.

        **Memory Integration**: Establishes content context in family memory for intelligent organization.
        **Family Intelligence**: Applies family-appropriate tagging and access controls to new content.
      operationId: createWorkspaceContent
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorkspaceContentRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CreateWorkspaceContentMultipartRequest'
      responses:
        '201':
          description: Workspace content created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    $ref: '#/components/schemas/WorkspaceContent'
                  memory_integration:
                    $ref: '#/components/schemas/ContentMemoryIntegration'
                  family_context_analysis:
                    $ref: '#/components/schemas/FamilyContentAnalysis'
                  collaboration_opportunities:
                    $ref: '#/components/schemas/CollaborationOpportunities'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '413':
          description: Content too large
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Content

  /workspaces/{workspace_id}/insights:
    get:
      summary: Get Workspace Insights
      description: |
        Retrieve AI-powered workspace insights using family memory and collaboration patterns.

        **Memory Integration**: Provides insights based on family memory patterns and workspace history.
        **Family Intelligence**: Analyzes collaboration effectiveness and family engagement patterns.
      operationId: getWorkspaceInsights
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
        - name: insight_type
          in: query
          description: Type of insights to generate
          required: false
          schema:
            type: string
            enum: [collaboration, family_engagement, productivity, memory_patterns, content_relevance]
        - name: time_range
          in: query
          description: Time range for insight analysis
          required: false
          schema:
            type: string
            enum: [day, week, month, quarter, year]
            default: month
      responses:
        '200':
          description: Workspace insights retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  collaboration_insights:
                    $ref: '#/components/schemas/CollaborationInsights'
                  family_engagement_insights:
                    $ref: '#/components/schemas/FamilyEngagementInsights'
                  productivity_insights:
                    $ref: '#/components/schemas/ProductivityInsights'
                  memory_pattern_insights:
                    $ref: '#/components/schemas/MemoryPatternInsights'
                  recommendations:
                    $ref: '#/components/schemas/WorkspaceRecommendations'
                  insight_metadata:
                    $ref: '#/components/schemas/InsightMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Workspace Intelligence

  /workspaces/{workspace_id}/handoff:
    post:
      summary: Initiate Workspace Handoff
      description: |
        Initiate cross-device workspace handoff with memory context preservation.

        **Device Ecosystem**: Enables seamless workspace transition between family devices.
        **Memory Integration**: Preserves workspace context and collaboration state during handoff.
      operationId: initiateWorkspaceHandoff
      parameters:
        - name: workspace_id
          in: path
          description: Workspace identifier
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InitiateHandoffRequest'
      responses:
        '200':
          description: Workspace handoff initiated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  handoff_id:
                    type: string
                    format: uuid
                  target_device_preparation:
                    $ref: '#/components/schemas/DevicePreparationStatus'
                  memory_context_transfer:
                    $ref: '#/components/schemas/MemoryContextTransfer'
                  collaboration_state_preservation:
                    $ref: '#/components/schemas/CollaborationStatePreservation'
                  estimated_completion_time:
                    type: string
                    format: date-time
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Device Handoff

components:
  securitySchemes:
    FamilyOSAuth:
      type: oauth2
      description: FamilyOS OAuth2 authentication with workspace-specific scopes
      flows:
        authorizationCode:
          authorizationUrl: https://auth.familyos.local/oauth/authorize
          tokenUrl: https://auth.familyos.local/oauth/token
          scopes:
            workspaces:read: Read workspace information and content
            workspaces:write: Create and modify workspaces
            workspaces:admin: Full workspace administration
            workspaces:family: Access family workspace coordination
            workspaces:insights: Access AI-powered workspace insights

    DeviceAuth:
      type: apiKey
      description: Device-specific authentication for workspace operations
      name: X-Device-Token
      in: header

  schemas:
    FamilyWorkspace:
      type: object
      description: Family-aware workspace with memory integration
      properties:
        workspace_id:
          type: string
          format: uuid
          description: Unique workspace identifier
        name:
          type: string
          description: Workspace name
        description:
          type: string
          description: Workspace description
        workspace_type:
          type: string
          enum: [family, personal, shared, project, emergency]
          description: Workspace type
        owner_id:
          type: string
          format: uuid
          description: Workspace owner (family member)
        family_id:
          type: string
          format: uuid
          description: Associated family identifier
        privacy_level:
          type: string
          enum: [public, family, private, restricted]
          description: Workspace privacy level
        created_at:
          type: string
          format: date-time
          description: Workspace creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
        last_activity:
          type: string
          format: date-time
          description: Last activity timestamp
        status:
          type: string
          enum: [active, archived, suspended]
          description: Workspace status
        member_count:
          type: integer
          description: Number of workspace members
        content_count:
          type: integer
          description: Number of content items
        family_context:
          $ref: '#/components/schemas/WorkspaceFamilyContext'
        memory_integration:
          $ref: '#/components/schemas/WorkspaceMemoryIntegration'
        collaboration_features:
          $ref: '#/components/schemas/CollaborationFeatures'
        access_permissions:
          $ref: '#/components/schemas/WorkspaceAccessPermissions'
      required:
        - workspace_id
        - name
        - workspace_type
        - owner_id
        - family_id
        - privacy_level
        - created_at
        - status

    FamilyWorkspaceDetailed:
      allOf:
        - $ref: '#/components/schemas/FamilyWorkspace'
        - type: object
          properties:
            detailed_description:
              type: string
              description: Extended workspace description
            workspace_settings:
              $ref: '#/components/schemas/WorkspaceSettings'
            family_policies:
              $ref: '#/components/schemas/WorkspaceFamilyPolicies'
            memory_insights:
              $ref: '#/components/schemas/WorkspaceMemoryInsights'
            collaboration_analytics:
              $ref: '#/components/schemas/CollaborationAnalytics'
            recent_activity:
              type: array
              items:
                $ref: '#/components/schemas/WorkspaceActivity'

    CreateWorkspaceRequest:
      type: object
      properties:
        name:
          type: string
          description: Workspace name
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Workspace description
          maxLength: 1000
        workspace_type:
          type: string
          enum: [family, personal, shared, project, emergency]
          description: Workspace type
        privacy_level:
          type: string
          enum: [public, family, private, restricted]
          description: Workspace privacy level
        family_coordination:
          $ref: '#/components/schemas/FamilyCoordinationSettings'
        memory_integration:
          $ref: '#/components/schemas/MemoryIntegrationSettings'
        initial_members:
          type: array
          items:
            $ref: '#/components/schemas/InitialWorkspaceMember'
          description: Initial workspace members
        collaboration_features:
          $ref: '#/components/schemas/CollaborationFeatureSettings'
        workspace_settings:
          $ref: '#/components/schemas/WorkspaceSettings'
      required:
        - name
        - workspace_type
        - privacy_level

    UpdateWorkspaceRequest:
      type: object
      properties:
        name:
          type: string
          description: Updated workspace name
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Updated workspace description
          maxLength: 1000
        privacy_level:
          type: string
          enum: [public, family, private, restricted]
          description: Updated privacy level
        family_coordination:
          $ref: '#/components/schemas/FamilyCoordinationSettings'
        memory_integration:
          $ref: '#/components/schemas/MemoryIntegrationSettings'
        collaboration_features:
          $ref: '#/components/schemas/CollaborationFeatureSettings'
        workspace_settings:
          $ref: '#/components/schemas/WorkspaceSettings'
        status:
          type: string
          enum: [active, archived]
          description: Updated workspace status

    WorkspaceMember:
      type: object
      description: Workspace member with family relationship context
      properties:
        user_id:
          type: string
          format: uuid
          description: User identifier
        display_name:
          type: string
          description: Member display name
        role:
          type: string
          enum: [owner, admin, editor, viewer, guest]
          description: Workspace role
        permissions:
          type: array
          items:
            type: string
          description: Specific permissions granted
        family_relationship:
          type: string
          description: Relationship to workspace owner
        joined_at:
          type: string
          format: date-time
          description: Member join timestamp
        last_activity:
          type: string
          format: date-time
          description: Last activity timestamp
        collaboration_score:
          type: number
          minimum: 0
          maximum: 1
          description: AI-computed collaboration effectiveness score
        family_context:
          $ref: '#/components/schemas/MemberFamilyContext'
        access_patterns:
          $ref: '#/components/schemas/MemberAccessPatterns'
      required:
        - user_id
        - display_name
        - role
        - joined_at

    AddWorkspaceMemberRequest:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
          description: User to add as member
        role:
          type: string
          enum: [admin, editor, viewer, guest]
          description: Initial workspace role
        custom_permissions:
          type: array
          items:
            type: string
          description: Custom permissions to grant
        family_relationship_context:
          type: string
          description: Family relationship context for permission determination
        notification_preferences:
          $ref: '#/components/schemas/MemberNotificationPreferences'
        collaboration_preferences:
          $ref: '#/components/schemas/MemberCollaborationPreferences'
      required:
        - user_id
        - role

    WorkspaceContent:
      type: object
      description: Workspace content with memory and family context
      properties:
        content_id:
          type: string
          format: uuid
          description: Content identifier
        title:
          type: string
          description: Content title
        content_type:
          type: string
          enum: [document, image, video, audio, note, task, event, memory]
          description: Content type
        content_url:
          type: string
          format: uri
          description: Content access URL
        thumbnail_url:
          type: string
          format: uri
          description: Content thumbnail URL
        size_bytes:
          type: integer
          description: Content size in bytes
        created_by:
          type: string
          format: uuid
          description: Content creator user ID
        created_at:
          type: string
          format: date-time
          description: Content creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
        family_appropriate:
          type: boolean
          description: Whether content is family-appropriate
        age_restrictions:
          type: array
          items:
            type: integer
          description: Age restrictions for content access
        memory_connections:
          type: array
          items:
            $ref: '#/components/schemas/MemoryConnection'
          description: Connections to family memory
        collaboration_metadata:
          $ref: '#/components/schemas/ContentCollaborationMetadata'
        access_permissions:
          $ref: '#/components/schemas/ContentAccessPermissions'
      required:
        - content_id
        - title
        - content_type
        - created_by
        - created_at
        - family_appropriate

    CreateWorkspaceContentRequest:
      type: object
      properties:
        title:
          type: string
          description: Content title
          minLength: 1
          maxLength: 255
        content_type:
          type: string
          enum: [document, image, video, audio, note, task, event, memory]
          description: Content type
        content_data:
          type: string
          description: Content data (base64 encoded for binary content)
        family_appropriate:
          type: boolean
          default: true
          description: Whether content is family-appropriate
        age_restrictions:
          type: array
          items:
            type: integer
          description: Age restrictions for content access
        memory_tags:
          type: array
          items:
            type: string
          description: Tags for memory integration
        collaboration_settings:
          $ref: '#/components/schemas/ContentCollaborationSettings'
        access_permissions:
          $ref: '#/components/schemas/ContentAccessPermissions'
      required:
        - title
        - content_type

    InitiateHandoffRequest:
      type: object
      properties:
        target_device_id:
          type: string
          pattern: '^[A-Za-z0-9._:-]{3,64}$'
          description: Target device for handoff
        preserve_state:
          type: boolean
          default: true
          description: Whether to preserve workspace state
        include_memory_context:
          type: boolean
          default: true
          description: Include memory context in handoff
        handoff_priority:
          type: string
          enum: [normal, high, urgent]
          default: normal
          description: Handoff priority level
        context_data:
          type: object
          description: Additional context data for handoff
      required:
        - target_device_id

    # Supporting schemas for workspace family and memory context
    WorkspaceFamilyContext:
      type: object
      properties:
        family_id:
          type: string
          format: uuid
        family_members_count:
          type: integer
        relationship_dynamics:
          type: object
        age_range:
          type: object
          properties:
            min_age:
              type: integer
            max_age:
              type: integer
        family_coordination_enabled:
          type: boolean

    WorkspaceMemoryIntegration:
      type: object
      properties:
        memory_enabled:
          type: boolean
        memory_context_preservation:
          type: boolean
        intelligent_organization:
          type: boolean
        memory_triggered_insights:
          type: boolean
        cross_workspace_memory_connections:
          type: boolean

    CollaborationFeatures:
      type: object
      properties:
        real_time_collaboration:
          type: boolean
        family_coordination:
          type: boolean
        age_appropriate_filtering:
          type: boolean
        memory_enhanced_suggestions:
          type: boolean
        cross_device_handoff:
          type: boolean
        intelligent_notifications:
          type: boolean

    # Error schemas
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
            trace_id:
              type: string
          required:
            - code
            - message
      required:
        - error

    ConflictError:
      allOf:
        - $ref: '#/components/schemas/ErrorResponse'
        - type: object
          properties:
            conflict_type:
              type: string
              enum: [member_exists, workspace_exists, permission_conflict]
            existing_resource:
              type: object

  responses:
    BadRequestError:
      description: Invalid request parameters or payload
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    ForbiddenError:
      description: Insufficient permissions or family policy violation
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Requested workspace or resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

tags:
  - name: Workspace Management
    description: |
      Manage family-aware workspaces with memory integration and intelligent collaboration.

      **Memory Integration**: Workspaces leverage family memory for intelligent organization and insights.

  - name: Workspace Members
    description: |
      Manage workspace members with family relationship awareness and collaboration optimization.

      **Family Intelligence**: Member management respects family hierarchy and relationship appropriateness.

  - name: Workspace Content
    description: |
      Manage workspace content with memory-driven organization and family-appropriate filtering.

      **Content Intelligence**: Content organization leverages family memory and collaboration patterns.

  - name: Workspace Intelligence
    description: |
      AI-powered workspace insights using family memory and collaboration analysis.

      **Intelligence Layer**: Advanced analytics provide family-aware workspace optimization insights.

  - name: Device Handoff
    description: |
      Seamless workspace transitions between family devices with memory context preservation.

      **Device Ecosystem**: Cross-device handoff maintains workspace state and family coordination.
