openapi: 3.1.0
info:
  title: MemoryOS App Plane - Connectors API
  description: |
    **Memory-Centric Family AI Connector Management**

    This API manages external application connectors that integrate with the Memory-Centric Family AI system:
    - **Connector Lifecycle**: Registration, authorization, and management of external app integrations
    - **Memory Integration**: Connectors can contribute to family memory formation and recall operations
    - **Family-Aware Webhooks**: External apps receive family-context events while respecting privacy
    - **Capability Discovery**: Apps can discover and register memory-relevant capabilities
    - **Secure Authorization**: OAuth2 flows with family-appropriate scope restrictions

    **Memory-Centric Design**: All connectors integrate with the Memory Backbone to:
    - Contribute contextual information to family memory formation
    - Receive family-appropriate notifications and updates
    - Respect family privacy boundaries and age-appropriate content filtering
    - Enable cross-device coordination through memory sync

    **Architecture Integration**:
    - Feeds Memory Backbone through Pipeline P09 (Connector Integration)
    - Integrates with Family Intelligence for relationship-aware data flow
    - Respects Device Ecosystem capabilities and limitations
    - Supports family administration through Control Plane integration
  version: "1.0.0"
  contact:
    name: MemoryOS API Team
    url: https://familyos.local/support
    email: api-support@familyos.local
  license:
    name: Family OS Private License
    url: https://familyos.local/licenses/family-os

servers:
  - url: https://api.familyos.local/app/v1
    description: Production App Plane
  - url: https://staging-api.familyos.local/app/v1
    description: Staging Environment
  - url: http://localhost:8080/app/v1
    description: Local Development

security:
  - FamilyOSAuth: []
  - DeviceAuth: []

paths:
  /connectors:
    get:
      summary: List Available Connectors
      description: |
        Retrieve available connectors with family-appropriate filtering and capability information.

        **Memory Integration**: Returns connectors that can contribute to family memory with capability assessment.
        **Family Intelligence**: Filters connectors based on family policies and age-appropriate content.
      operationId: listConnectors
      parameters:
        - name: category
          in: query
          description: Filter connectors by category
          required: false
          schema:
            type: string
            enum: [productivity, social, entertainment, education, health, finance, smart_home, communication]
        - name: memory_integration
          in: query
          description: Filter by memory integration capability
          required: false
          schema:
            type: boolean
        - name: family_safe
          in: query
          description: Show only family-safe connectors
          required: false
          schema:
            type: boolean
            default: true
        - name: age_appropriate
          in: query
          description: Filter by age appropriateness
          required: false
          schema:
            type: string
            enum: [all_ages, teen_plus, adult_only]
      responses:
        '200':
          description: Available connectors retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  connectors:
                    type: array
                    items:
                      $ref: '#/components/schemas/ConnectorInfo'
                  total_count:
                    type: integer
                  family_policies_applied:
                    type: array
                    items:
                      type: string
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Connector Discovery

  /connectors/{connector_id}:
    get:
      summary: Get Connector Details
      description: |
        Retrieve detailed information about a specific connector including capabilities and family compatibility.

        **Memory Integration**: Shows how connector data integrates with family memory and available memory operations.
        **Family Intelligence**: Provides family-specific compatibility and safety assessment.
      operationId: getConnectorDetails
      parameters:
        - name: connector_id
          in: path
          description: Connector identifier
          required: true
          schema:
            type: string
            pattern: '^[A-Za-z0-9._:-]{3,64}$'
      responses:
        '200':
          description: Connector details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  connector:
                    $ref: '#/components/schemas/ConnectorDetailed'
                  memory_capabilities:
                    $ref: '#/components/schemas/ConnectorMemoryCapabilities'
                  family_compatibility:
                    $ref: '#/components/schemas/FamilyCompatibilityAssessment'
                  installation_requirements:
                    $ref: '#/components/schemas/InstallationRequirements'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Connector Discovery

  /connectors/installed:
    get:
      summary: List Installed Connectors
      description: |
        Retrieve connectors currently installed and configured for the family.

        **Memory Integration**: Shows active memory integration status and data flow patterns.
        **Family Intelligence**: Displays family-specific configuration and usage patterns.
      operationId: listInstalledConnectors
      parameters:
        - name: status_filter
          in: query
          description: Filter by connector status
          required: false
          schema:
            type: string
            enum: [active, inactive, error, pending_auth]
        - name: include_usage_stats
          in: query
          description: Include usage and memory contribution statistics
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Installed connectors retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  installed_connectors:
                    type: array
                    items:
                      $ref: '#/components/schemas/InstalledConnector'
                  usage_summary:
                    $ref: '#/components/schemas/ConnectorUsageSummary'
                  memory_contribution_stats:
                    $ref: '#/components/schemas/MemoryContributionStats'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Connector Management

    post:
      summary: Install Connector
      description: |
        Install and configure a new connector with family-appropriate settings and memory integration.

        **Memory Integration**: Configures connector for memory contribution and establishes data flow to Memory Backbone.
        **Family Intelligence**: Applies family policies and age-appropriate restrictions during installation.
      operationId: installConnector
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstallConnectorRequest'
      responses:
        '201':
          description: Connector installed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  installed_connector:
                    $ref: '#/components/schemas/InstalledConnector'
                  authorization_url:
                    type: string
                    format: uri
                    description: OAuth authorization URL if required
                  memory_integration_status:
                    $ref: '#/components/schemas/MemoryIntegrationStatus'
                  family_policies_applied:
                    type: array
                    items:
                      type: string
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          description: Connector already installed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Connector Management

  /connectors/installed/{connector_id}:
    get:
      summary: Get Installed Connector Status
      description: |
        Retrieve detailed status and configuration of an installed connector.

        **Memory Integration**: Shows memory data flow, contribution patterns, and integration health.
        **Family Intelligence**: Displays family-specific usage patterns and effectiveness metrics.
      operationId: getInstalledConnectorStatus
      parameters:
        - name: connector_id
          in: path
          description: Installed connector identifier
          required: true
          schema:
            type: string
            pattern: '^[A-Za-z0-9._:-]{3,64}$'
        - name: include_recent_activity
          in: query
          description: Include recent activity and memory contributions
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Installed connector status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  connector:
                    $ref: '#/components/schemas/InstalledConnectorDetailed'
                  memory_integration_health:
                    $ref: '#/components/schemas/MemoryIntegrationHealth'
                  recent_activity:
                    $ref: '#/components/schemas/ConnectorRecentActivity'
                  family_usage_patterns:
                    $ref: '#/components/schemas/FamilyUsagePatterns'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Connector Management

    put:
      summary: Update Connector Configuration
      description: |
        Update connector configuration including memory integration settings and family policies.

        **Memory Integration**: Modifies memory data flow and contribution settings.
        **Family Intelligence**: Updates family-specific restrictions and age-appropriate filtering.
      operationId: updateConnectorConfiguration
      parameters:
        - name: connector_id
          in: path
          description: Installed connector identifier
          required: true
          schema:
            type: string
            pattern: '^[A-Za-z0-9._:-]{3,64}$'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateConnectorRequest'
      responses:
        '200':
          description: Connector configuration updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  connector:
                    $ref: '#/components/schemas/InstalledConnector'
                  configuration_changes:
                    type: array
                    items:
                      type: string
                  memory_integration_impact:
                    $ref: '#/components/schemas/MemoryIntegrationImpact'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Connector Management

    delete:
      summary: Uninstall Connector
      description: |
        Uninstall a connector and handle memory data cleanup according to family policies.

        **Memory Integration**: Manages cleanup of connector-contributed memories and data migration.
        **Family Intelligence**: Applies family data retention policies and privacy controls.
      operationId: uninstallConnector
      parameters:
        - name: connector_id
          in: path
          description: Installed connector identifier
          required: true
          schema:
            type: string
            pattern: '^[A-Za-z0-9._:-]{3,64}$'
        - name: data_retention_strategy
          in: query
          description: Strategy for handling connector-contributed data
          required: false
          schema:
            type: string
            enum: [retain_memories, archive_data, delete_all]
            default: retain_memories
      responses:
        '200':
          description: Connector uninstalled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  connector_id:
                    type: string
                  uninstall_summary:
                    $ref: '#/components/schemas/ConnectorUninstallSummary'
                  memory_data_handling:
                    $ref: '#/components/schemas/MemoryDataHandling'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Connector Management

  /connectors/installed/{connector_id}/authorize:
    post:
      summary: Authorize Connector
      description: |
        Complete OAuth authorization for a connector with family-appropriate scope restrictions.

        **Memory Integration**: Finalizes memory integration authorization and data flow permissions.
        **Family Intelligence**: Applies family policies to authorization scope and data access.
      operationId: authorizeConnector
      parameters:
        - name: connector_id
          in: path
          description: Installed connector identifier
          required: true
          schema:
            type: string
            pattern: '^[A-Za-z0-9._:-]{3,64}$'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConnectorAuthorizationRequest'
      responses:
        '200':
          description: Connector authorized successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  authorization_status:
                    type: string
                    enum: [authorized, pending, failed]
                  granted_scopes:
                    type: array
                    items:
                      type: string
                  memory_permissions:
                    $ref: '#/components/schemas/MemoryPermissions'
                  family_restrictions_applied:
                    type: array
                    items:
                      type: string
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Connector Authorization

  /connectors/installed/{connector_id}/revoke:
    post:
      summary: Revoke Connector Authorization
      description: |
        Revoke authorization for a connector while preserving existing memory contributions.

        **Memory Integration**: Stops new memory contributions while preserving existing family memories.
        **Family Intelligence**: Maintains family data integrity and relationship context.
      operationId: revokeConnectorAuthorization
      parameters:
        - name: connector_id
          in: path
          description: Installed connector identifier
          required: true
          schema:
            type: string
            pattern: '^[A-Za-z0-9._:-]{3,64}$'
      responses:
        '200':
          description: Connector authorization revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  connector_id:
                    type: string
                  revocation_status:
                    type: string
                    enum: [revoked, pending, failed]
                  memory_data_preserved:
                    type: boolean
                  family_data_impact:
                    $ref: '#/components/schemas/FamilyDataImpact'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Connector Authorization

  /webhooks:
    get:
      summary: List Webhook Configurations
      description: |
        Retrieve webhook configurations for family-appropriate event delivery to external systems.

        **Memory Integration**: Shows webhook configurations for memory-related events and family updates.
        **Family Intelligence**: Displays family-aware event filtering and privacy-compliant delivery.
      operationId: listWebhookConfigurations
      parameters:
        - name: connector_id
          in: query
          description: Filter webhooks by connector
          required: false
          schema:
            type: string
            pattern: '^[A-Za-z0-9._:-]{3,64}$'
        - name: event_type_filter
          in: query
          description: Filter by event type
          required: false
          schema:
            type: string
            enum: [memory_events, family_events, device_events, presence_events]
      responses:
        '200':
          description: Webhook configurations retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  webhooks:
                    type: array
                    items:
                      $ref: '#/components/schemas/WebhookConfiguration'
                  total_count:
                    type: integer
                  family_privacy_controls:
                    $ref: '#/components/schemas/FamilyPrivacyControls'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Webhook Management

    post:
      summary: Create Webhook Configuration
      description: |
        Create a new webhook configuration with family-appropriate event filtering and privacy controls.

        **Memory Integration**: Configures webhook delivery for memory events with family context preservation.
        **Family Intelligence**: Applies family policies and age-appropriate event filtering.
      operationId: createWebhookConfiguration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWebhookRequest'
      responses:
        '201':
          description: Webhook configuration created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  webhook:
                    $ref: '#/components/schemas/WebhookConfiguration'
                  verification_challenge:
                    type: string
                    description: Webhook verification challenge if required
                  family_filters_applied:
                    type: array
                    items:
                      type: string
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Webhook Management

  /webhooks/{webhook_id}:
    get:
      summary: Get Webhook Configuration Details
      description: |
        Retrieve detailed webhook configuration including delivery status and family filtering.

        **Memory Integration**: Shows memory event delivery patterns and success rates.
        **Family Intelligence**: Displays family-specific filtering effectiveness and privacy compliance.
      operationId: getWebhookConfiguration
      parameters:
        - name: webhook_id
          in: path
          description: Webhook configuration identifier
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Webhook configuration retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  webhook:
                    $ref: '#/components/schemas/WebhookConfigurationDetailed'
                  delivery_stats:
                    $ref: '#/components/schemas/WebhookDeliveryStats'
                  family_filtering_stats:
                    $ref: '#/components/schemas/FamilyFilteringStats'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Webhook Management

    put:
      summary: Update Webhook Configuration
      description: |
        Update webhook configuration including event filters and family privacy settings.

        **Memory Integration**: Modifies memory event delivery and family context preservation.
        **Family Intelligence**: Updates family-specific filtering and privacy controls.
      operationId: updateWebhookConfiguration
      parameters:
        - name: webhook_id
          in: path
          description: Webhook configuration identifier
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWebhookRequest'
      responses:
        '200':
          description: Webhook configuration updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  webhook:
                    $ref: '#/components/schemas/WebhookConfiguration'
                  configuration_changes:
                    type: array
                    items:
                      type: string
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Webhook Management

    delete:
      summary: Delete Webhook Configuration
      description: |
        Delete a webhook configuration and stop event delivery.

        **Memory Integration**: Stops memory event delivery while preserving historical delivery records.
        **Family Intelligence**: Maintains family data integrity during webhook removal.
      operationId: deleteWebhookConfiguration
      parameters:
        - name: webhook_id
          in: path
          description: Webhook configuration identifier
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Webhook configuration deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  webhook_id:
                    type: string
                    format: uuid
                  deletion_summary:
                    $ref: '#/components/schemas/WebhookDeletionSummary'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      tags:
        - Webhook Management

components:
  securitySchemes:
    FamilyOSAuth:
      type: oauth2
      description: FamilyOS OAuth2 authentication with connector-specific scopes
      flows:
        authorizationCode:
          authorizationUrl: https://auth.familyos.local/oauth/authorize
          tokenUrl: https://auth.familyos.local/oauth/token
          scopes:
            connectors:read: Read connector information and configurations
            connectors:install: Install and manage family connectors
            connectors:authorize: Authorize connector access to family data
            webhooks:manage: Manage webhook configurations and delivery
            memory:contribute: Allow connectors to contribute to family memory

    DeviceAuth:
      type: apiKey
      description: Device-specific authentication for connector operations
      name: X-Device-Token
      in: header

  schemas:
    ConnectorInfo:
      type: object
      description: Basic connector information with family compatibility
      properties:
        connector_id:
          type: string
          pattern: '^[A-Za-z0-9._:-]{3,64}$'
          description: Unique connector identifier
        name:
          type: string
          description: Connector display name
        description:
          type: string
          description: Connector description and capabilities
        category:
          type: string
          enum: [productivity, social, entertainment, education, health, finance, smart_home, communication]
          description: Connector category
        icon_url:
          type: string
          format: uri
          description: Connector icon URL
        developer:
          type: string
          description: Connector developer name
        version:
          type: string
          pattern: '^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z-.]+)?$'
          description: Connector version
        family_safe:
          type: boolean
          description: Whether connector is family-safe
        age_rating:
          type: string
          enum: [all_ages, teen_plus, adult_only]
          description: Age appropriateness rating
        memory_integration:
          type: boolean
          description: Whether connector supports memory integration
        popularity_score:
          type: number
          minimum: 0
          maximum: 1
          description: Connector popularity score
      required:
        - connector_id
        - name
        - description
        - category
        - family_safe
        - memory_integration

    ConnectorDetailed:
      allOf:
        - $ref: '#/components/schemas/ConnectorInfo'
        - type: object
          properties:
            detailed_description:
              type: string
              description: Comprehensive connector description
            privacy_policy_url:
              type: string
              format: uri
              description: Connector privacy policy URL
            terms_of_service_url:
              type: string
              format: uri
              description: Terms of service URL
            support_url:
              type: string
              format: uri
              description: Support and documentation URL
            required_permissions:
              type: array
              items:
                type: string
              description: Required permissions for connector operation
            optional_permissions:
              type: array
              items:
                type: string
              description: Optional permissions for enhanced functionality
            data_types_accessed:
              type: array
              items:
                type: string
              description: Types of data the connector accesses
            oauth_scopes:
              type: array
              items:
                type: string
              description: OAuth scopes required by connector

    ConnectorMemoryCapabilities:
      type: object
      description: Connector memory integration capabilities
      properties:
        memory_contribution:
          type: boolean
          description: Can contribute to family memory formation
        memory_recall:
          type: boolean
          description: Can trigger memory recall operations
        context_enhancement:
          type: boolean
          description: Can enhance memory with additional context
        real_time_updates:
          type: boolean
          description: Provides real-time memory updates
        supported_memory_types:
          type: array
          items:
            type: string
            enum: [episodic, semantic, procedural, working]
          description: Supported memory types for integration
        data_formats:
          type: array
          items:
            type: string
          description: Supported data formats for memory integration
        update_frequency:
          type: string
          enum: [real_time, frequent, periodic, on_demand]
          description: Memory update frequency capability

    FamilyCompatibilityAssessment:
      type: object
      description: Family compatibility and safety assessment
      properties:
        overall_rating:
          type: string
          enum: [excellent, good, fair, poor, unsuitable]
          description: Overall family compatibility rating
        safety_score:
          type: number
          minimum: 0
          maximum: 1
          description: Family safety score
        privacy_compliance:
          type: string
          enum: [full, partial, minimal, none]
          description: Privacy regulation compliance level
        child_safety_features:
          type: array
          items:
            type: string
          description: Child safety features provided
        parental_controls:
          type: boolean
          description: Supports parental control integration
        age_verification:
          type: boolean
          description: Supports age verification
        content_filtering:
          type: boolean
          description: Supports content filtering
        family_sharing_compatible:
          type: boolean
          description: Compatible with family sharing policies

    InstalledConnector:
      type: object
      description: Installed connector with current status and configuration
      properties:
        connector_id:
          type: string
          pattern: '^[A-Za-z0-9._:-]{3,64}$'
          description: Connector identifier
        installation_id:
          type: string
          format: uuid
          description: Unique installation identifier
        name:
          type: string
          description: Connector name
        status:
          type: string
          enum: [active, inactive, error, pending_auth, suspended]
          description: Current connector status
        installed_at:
          type: string
          format: date-time
          description: Installation timestamp
        last_activity:
          type: string
          format: date-time
          description: Last activity timestamp
        authorization_status:
          type: string
          enum: [authorized, pending, expired, revoked]
          description: Authorization status
        memory_integration_enabled:
          type: boolean
          description: Whether memory integration is active
        family_restrictions:
          type: array
          items:
            type: string
          description: Applied family restrictions
        configuration:
          $ref: '#/components/schemas/ConnectorConfiguration'
      required:
        - connector_id
        - installation_id
        - name
        - status
        - installed_at

    InstalledConnectorDetailed:
      allOf:
        - $ref: '#/components/schemas/InstalledConnector'
        - type: object
          properties:
            detailed_status:
              $ref: '#/components/schemas/ConnectorDetailedStatus'
            permissions_granted:
              type: array
              items:
                type: string
              description: Permissions granted to connector
            memory_integration_stats:
              $ref: '#/components/schemas/MemoryIntegrationStats'
            error_history:
              type: array
              items:
                $ref: '#/components/schemas/ConnectorError'
            usage_analytics:
              $ref: '#/components/schemas/ConnectorUsageAnalytics'

    InstallConnectorRequest:
      type: object
      properties:
        connector_id:
          type: string
          pattern: '^[A-Za-z0-9._:-]{3,64}$'
          description: Connector to install
        configuration:
          $ref: '#/components/schemas/ConnectorConfiguration'
        requested_permissions:
          type: array
          items:
            type: string
          description: Requested permissions for connector
        memory_integration_preferences:
          $ref: '#/components/schemas/MemoryIntegrationPreferences'
        family_restrictions:
          type: array
          items:
            type: string
          description: Family-specific restrictions to apply
        auto_authorize:
          type: boolean
          default: false
          description: Whether to auto-authorize if possible
      required:
        - connector_id

    UpdateConnectorRequest:
      type: object
      properties:
        configuration:
          $ref: '#/components/schemas/ConnectorConfiguration'
        memory_integration_preferences:
          $ref: '#/components/schemas/MemoryIntegrationPreferences'
        family_restrictions:
          type: array
          items:
            type: string
          description: Updated family restrictions
        status:
          type: string
          enum: [active, inactive, suspended]
          description: Updated connector status

    ConnectorAuthorizationRequest:
      type: object
      properties:
        authorization_code:
          type: string
          description: OAuth authorization code
        state:
          type: string
          description: OAuth state parameter
        redirect_uri:
          type: string
          format: uri
          description: OAuth redirect URI
        requested_scopes:
          type: array
          items:
            type: string
          description: Additional scopes to request
      required:
        - authorization_code

    WebhookConfiguration:
      type: object
      description: Webhook configuration for event delivery
      properties:
        webhook_id:
          type: string
          format: uuid
          description: Unique webhook identifier
        connector_id:
          type: string
          pattern: '^[A-Za-z0-9._:-]{3,64}$'
          description: Associated connector identifier
        endpoint_url:
          type: string
          format: uri
          description: Webhook delivery endpoint
        event_types:
          type: array
          items:
            type: string
          description: Event types to deliver
        content_type:
          type: string
          enum: [application/json, application/x-www-form-urlencoded]
          description: Content type for webhook delivery
        signing_secret:
          type: string
          description: Webhook signing secret (masked)
        active:
          type: boolean
          description: Whether webhook is active
        created_at:
          type: string
          format: date-time
          description: Webhook creation timestamp
        family_filters:
          $ref: '#/components/schemas/FamilyWebhookFilters'
      required:
        - webhook_id
        - connector_id
        - endpoint_url
        - event_types

    WebhookConfigurationDetailed:
      allOf:
        - $ref: '#/components/schemas/WebhookConfiguration'
        - type: object
          properties:
            delivery_configuration:
              $ref: '#/components/schemas/WebhookDeliveryConfiguration'
            retry_policy:
              $ref: '#/components/schemas/WebhookRetryPolicy'
            security_configuration:
              $ref: '#/components/schemas/WebhookSecurityConfiguration'
            family_privacy_settings:
              $ref: '#/components/schemas/FamilyPrivacySettings'

    CreateWebhookRequest:
      type: object
      properties:
        connector_id:
          type: string
          pattern: '^[A-Za-z0-9._:-]{3,64}$'
          description: Associated connector identifier
        endpoint_url:
          type: string
          format: uri
          description: Webhook delivery endpoint
        event_types:
          type: array
          items:
            type: string
          description: Event types to deliver
          minItems: 1
        content_type:
          type: string
          enum: [application/json, application/x-www-form-urlencoded]
          default: application/json
          description: Content type for delivery
        family_filters:
          $ref: '#/components/schemas/FamilyWebhookFilters'
        delivery_configuration:
          $ref: '#/components/schemas/WebhookDeliveryConfiguration'
      required:
        - connector_id
        - endpoint_url
        - event_types

    UpdateWebhookRequest:
      type: object
      properties:
        endpoint_url:
          type: string
          format: uri
          description: Updated webhook endpoint
        event_types:
          type: array
          items:
            type: string
          description: Updated event types
        active:
          type: boolean
          description: Updated active status
        family_filters:
          $ref: '#/components/schemas/FamilyWebhookFilters'
        delivery_configuration:
          $ref: '#/components/schemas/WebhookDeliveryConfiguration'

    # Supporting Schemas
    ConnectorConfiguration:
      type: object
      description: Connector-specific configuration settings
      properties:
        memory_integration_enabled:
          type: boolean
          default: true
        real_time_updates:
          type: boolean
          default: false
        data_retention_days:
          type: integer
          minimum: 1
          maximum: 365
          default: 90
        family_sharing_enabled:
          type: boolean
          default: true
        content_filtering_level:
          type: string
          enum: [strict, moderate, permissive]
          default: moderate
      additionalProperties: true

    MemoryIntegrationPreferences:
      type: object
      description: Memory integration preferences for connector
      properties:
        contribute_to_episodic:
          type: boolean
          default: true
        contribute_to_semantic:
          type: boolean
          default: true
        contribute_to_procedural:
          type: boolean
          default: false
        memory_space_restrictions:
          type: array
          items:
            type: string
            enum: [personal, selective, shared, extended, interfamily]
        context_enrichment:
          type: boolean
          default: true
        automatic_categorization:
          type: boolean
          default: true

    FamilyWebhookFilters:
      type: object
      description: Family-specific webhook filtering configuration
      properties:
        include_child_events:
          type: boolean
          default: false
        age_appropriate_only:
          type: boolean
          default: true
        privacy_level_threshold:
          type: string
          enum: [public, family, parents_only, private]
          default: family
        relationship_context_filter:
          type: array
          items:
            type: string
        exclude_sensitive_data:
          type: boolean
          default: true

    # Additional supporting schemas for responses
    ConnectorUsageSummary:
      type: object
      properties:
        total_connectors:
          type: integer
        active_connectors:
          type: integer
        memory_contributing_connectors:
          type: integer
        total_webhook_deliveries:
          type: integer
        last_updated:
          type: string
          format: date-time

    MemoryContributionStats:
      type: object
      properties:
        total_memories_contributed:
          type: integer
        memories_by_type:
          type: object
          additionalProperties:
            type: integer
        contribution_rate_per_day:
          type: number
        top_contributing_connectors:
          type: array
          items:
            type: object
            properties:
              connector_id:
                type: string
              contribution_count:
                type: integer

    # Error schemas reused from users API
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
            trace_id:
              type: string
          required:
            - code
            - message
      required:
        - error

    ConflictError:
      allOf:
        - $ref: '#/components/schemas/ErrorResponse'
        - type: object
          properties:
            conflict_type:
              type: string
              enum: [connector_exists, webhook_exists, authorization_conflict]
            existing_resource:
              type: object

  responses:
    BadRequestError:
      description: Invalid request parameters or payload
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    ForbiddenError:
      description: Insufficient permissions or family policy violation
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Requested connector or configuration not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

tags:
  - name: Connector Discovery
    description: |
      Discover and explore available connectors with family compatibility assessment.

      **Memory Integration**: Connectors can contribute to family memory formation and enhancement.

  - name: Connector Management
    description: |
      Install, configure, and manage family connectors with memory integration.

      **Family Intelligence**: All connector operations respect family policies and age-appropriate restrictions.

  - name: Connector Authorization
    description: |
      Manage OAuth authorization for connectors with family-appropriate scope restrictions.

      **Security**: Family-aware authorization with privacy protection and data access controls.

  - name: Webhook Management
    description: |
      Configure webhooks for family-appropriate event delivery to external systems.

      **Privacy**: Webhook delivery respects family privacy boundaries and content filtering.
